<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Intro to Geospatial Data Analysis with GeoPandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="week3-geospatial-data-concepts_files/libs/clipboard/clipboard.min.js"></script>
<script src="week3-geospatial-data-concepts_files/libs/quarto-html/quarto.js"></script>
<script src="week3-geospatial-data-concepts_files/libs/quarto-html/popper.min.js"></script>
<script src="week3-geospatial-data-concepts_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week3-geospatial-data-concepts_files/libs/quarto-html/anchor.min.js"></script>
<link href="week3-geospatial-data-concepts_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week3-geospatial-data-concepts_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week3-geospatial-data-concepts_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week3-geospatial-data-concepts_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week3-geospatial-data-concepts_files/libs/bootstrap/bootstrap-81e35ebdb4125010edbabe6010586085.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#contents" id="toc-contents" class="nav-link active" data-scroll-target="#contents"><span class="header-section-number">1</span> Contents</a></li>
  <li><a href="#part-1-vector-geospatial-data-in-python" id="toc-part-1-vector-geospatial-data-in-python" class="nav-link" data-scroll-target="#part-1-vector-geospatial-data-in-python"><span class="header-section-number">2</span> Part 1: Vector geospatial data in Python</a>
  <ul class="collapse">
  <li><a href="#a-couple-of-terminology-notes" id="toc-a-couple-of-terminology-notes" class="nav-link" data-scroll-target="#a-couple-of-terminology-notes"><span class="header-section-number">2.1</span> A couple of terminology notes</a></li>
  <li><a href="#common-formats-for-vector-datasets" id="toc-common-formats-for-vector-datasets" class="nav-link" data-scroll-target="#common-formats-for-vector-datasets"><span class="header-section-number">2.2</span> Common formats for vector datasets</a></li>
  <li><a href="#analyzing-vector-data-with-geopandas" id="toc-analyzing-vector-data-with-geopandas" class="nav-link" data-scroll-target="#analyzing-vector-data-with-geopandas"><span class="header-section-number">2.3</span> Analyzing vector data with GeoPandas</a></li>
  <li><a href="#whats-a-geodataframe" id="toc-whats-a-geodataframe" class="nav-link" data-scroll-target="#whats-a-geodataframe"><span class="header-section-number">2.4</span> What’s a <code>GeoDataFrame</code>?</a></li>
  <li><a href="#we-can-still-leverage-the-power-of-pandas" id="toc-we-can-still-leverage-the-power-of-pandas" class="nav-link" data-scroll-target="#we-can-still-leverage-the-power-of-pandas"><span class="header-section-number">2.5</span> We can still leverage the power of <code>pandas</code>…</a></li>
  <li><a href="#how-does-geopandas-handle-coordinate-systems-and-map-projections" id="toc-how-does-geopandas-handle-coordinate-systems-and-map-projections" class="nav-link" data-scroll-target="#how-does-geopandas-handle-coordinate-systems-and-map-projections"><span class="header-section-number">2.6</span> How does <code>geopandas</code> handle coordinate systems and map projections?</a></li>
  <li><a href="#the-epsg4326-crs" id="toc-the-epsg4326-crs" class="nav-link" data-scroll-target="#the-epsg4326-crs"><span class="header-section-number">2.7</span> The EPSG=4326 CRS</a></li>
  <li><a href="#how-to-plot-all-of-the-geometries-at-once" id="toc-how-to-plot-all-of-the-geometries-at-once" class="nav-link" data-scroll-target="#how-to-plot-all-of-the-geometries-at-once"><span class="header-section-number">2.8</span> How to plot all of the geometries at once?</a></li>
  <li><a href="#can-we-convert-to-other-coordinate-systems" id="toc-can-we-convert-to-other-coordinate-systems" class="nav-link" data-scroll-target="#can-we-convert-to-other-coordinate-systems"><span class="header-section-number">2.9</span> Can we convert to other coordinate systems?</a></li>
  <li><a href="#lets-load-the-city-limits-for-philadelphia" id="toc-lets-load-the-city-limits-for-philadelphia" class="nav-link" data-scroll-target="#lets-load-the-city-limits-for-philadelphia"><span class="header-section-number">2.10</span> Let’s load the city limits for Philadelphia</a></li>
  <li><a href="#so-when-should-you-use-geopandas" id="toc-so-when-should-you-use-geopandas" class="nav-link" data-scroll-target="#so-when-should-you-use-geopandas"><span class="header-section-number">2.11</span> So, when should you use GeoPandas?</a></li>
  <li><a href="#when-it-may-not-be-the-best-tool" id="toc-when-it-may-not-be-the-best-tool" class="nav-link" data-scroll-target="#when-it-may-not-be-the-best-tool"><span class="header-section-number">2.12</span> When it may not be the best tool:</a></li>
  </ul></li>
  <li><a href="#part-2-spatial-relationships-and-joins" id="toc-part-2-spatial-relationships-and-joins" class="nav-link" data-scroll-target="#part-2-spatial-relationships-and-joins"><span class="header-section-number">3</span> Part 2: Spatial Relationships and Joins</a>
  <ul class="collapse">
  <li><a href="#a-quick-example" id="toc-a-quick-example" class="nav-link" data-scroll-target="#a-quick-example"><span class="header-section-number">3.1</span> A quick example</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">3.2</span> References</a></li>
  <li><a href="#the-spatial-join-sjoin" id="toc-the-spatial-join-sjoin" class="nav-link" data-scroll-target="#the-spatial-join-sjoin"><span class="header-section-number">3.3</span> 1. The spatial join: <code>sjoin()</code></a></li>
  <li><a href="#spatial-overlay-operation-overlay" id="toc-spatial-overlay-operation-overlay" class="nav-link" data-scroll-target="#spatial-overlay-operation-overlay"><span class="header-section-number">3.4</span> 2. Spatial overlay operation: <code>overlay()</code></a></li>
  <li><a href="#recap-spatial-operations" id="toc-recap-spatial-operations" class="nav-link" data-scroll-target="#recap-spatial-operations"><span class="header-section-number">3.5</span> Recap: spatial operations</a></li>
  </ul></li>
  <li><a href="#example-exploring-trash-related-311-tickets-by-neighborhood-in-2020" id="toc-example-exploring-trash-related-311-tickets-by-neighborhood-in-2020" class="nav-link" data-scroll-target="#example-exploring-trash-related-311-tickets-by-neighborhood-in-2020"><span class="header-section-number">4</span> Example: Exploring trash-related 311 tickets by neighborhood in 2020</a>
  <ul class="collapse">
  <li><a href="#first-convert-to-a-geodataframe" id="toc-first-convert-to-a-geodataframe" class="nav-link" data-scroll-target="#first-convert-to-a-geodataframe"><span class="header-section-number">4.1</span> First, convert to a GeoDataFrame</a></li>
  <li><a href="#lets-plot-the-monthly-trash-requests" id="toc-lets-plot-the-monthly-trash-requests" class="nav-link" data-scroll-target="#lets-plot-the-monthly-trash-requests"><span class="header-section-number">4.2</span> Let’s plot the monthly trash requests</a></li>
  <li><a href="#plot-a-bar-chart-with-seaborn" id="toc-plot-a-bar-chart-with-seaborn" class="nav-link" data-scroll-target="#plot-a-bar-chart-with-seaborn"><span class="header-section-number">4.3</span> Plot a bar chart with seaborn</a></li>
  <li><a href="#reference-lets-improve-the-aesthetics-via-matplotlib" id="toc-reference-lets-improve-the-aesthetics-via-matplotlib" class="nav-link" data-scroll-target="#reference-lets-improve-the-aesthetics-via-matplotlib"><span class="header-section-number">4.4</span> Reference: Let’s improve the aesthetics via matplotlib</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro to Geospatial Data Analysis with GeoPandas</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li>Sep 11, 2025</li>
</ul>
<section id="contents" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="contents"><span class="header-section-number">1</span> Contents</h2>
<ul>
<li>Introduction to GeoPandas and vector data</li>
<li>Spatial relationships and joins</li>
</ul>
<div id="cell-3" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="1">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's setup the imports we'll need first</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># import altair as alt</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="part-1-vector-geospatial-data-in-python" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="part-1-vector-geospatial-data-in-python"><span class="header-section-number">2</span> Part 1: Vector geospatial data in Python</h2>
<ul>
<li><strong>Vector</strong> refers to <strong>discrete geometric entities</strong></li>
<li>The <a href="https://en.wikipedia.org/wiki/Open_Geospatial_Consortium">Open Geospatial Consortium</a> has standardized a set of <a href="https://en.wikipedia.org/wiki/Simple_Features"><strong>simple features</strong></a></li>
<li>Includes points, lines, and polygons</li>
</ul>
<center>
<img src="imgs/simple-features.png" width="600">
</center>
<p><a href="https://www.earthdatascience.org/workshops/gis-open-source-python/intro-vector-data-python/">Source</a></p>
<section id="a-couple-of-terminology-notes" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="a-couple-of-terminology-notes"><span class="header-section-number">2.1</span> A couple of terminology notes</h3>
<ul>
<li>A <strong>feature</strong> refers to both the geometry and attributes of specific piece of vector data</li>
<li>A <strong>feature collection</strong> is a list, or collection, of features</li>
</ul>
<p>Both terms are very common in Python geospatial software.</p>
</section>
<section id="common-formats-for-vector-datasets" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="common-formats-for-vector-datasets"><span class="header-section-number">2.2</span> Common formats for vector datasets</h3>
<section id="a-shapefile" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="a-shapefile"><span class="header-section-number">2.2.1</span> 1. A shapefile</h4>
<p>Actually several files with the same common prefix.</p>
<p>Mandatory files:</p>
<ul>
<li><strong>.shp</strong>: the file containing the geometries</li>
<li><strong>.shx</strong>: the file that indexes the geometry</li>
<li><strong>.dbf</strong>: tabular data format storing the attributes for each geometry</li>
</ul>
<p>And many optional files for documentation, projection information, etc.</p>
<p>Let’s take a look at an example shapefile:</p>
<p>We’ll use the <code>%ls</code> command to <em>list</em> out all of the files in an example shapefile in the <code>data/</code> folder</p>
<div id="cell-10" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="2">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>ls <span class="st">"data/ne_110m_admin_0_countries/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ne_110m_admin_0_countries.cpg  ne_110m_admin_0_countries.shp
ne_110m_admin_0_countries.dbf  ne_110m_admin_0_countries.shx
ne_110m_admin_0_countries.prj</code></pre>
</div>
</div>
</section>
<section id="the-geojson-file" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="the-geojson-file"><span class="header-section-number">2.2.2</span> 2. The GeoJSON file</h4>
<ul>
<li>Stores simple features in a JSON format</li>
<li>Arose due to the prevalence of the JSON format, especially on the web</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="Additional GeoJSON resources">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional GeoJSON resources
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>GitHub lets you view GeoJSON files natively. See <a href="https://github.com/MUSA-550-Fall-2023/week-3/blob/main/data/Zipcodes_Poly.geojson">Philadelphia ZIP Codes</a> in the <code>data/</code> folder of this week’s repo.</li>
<li>http://geojson.io provides interactive creation and viewing of small GeoJSON files</li>
</ul>
</div>
</div>
</section>
</section>
<section id="analyzing-vector-data-with-geopandas" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="analyzing-vector-data-with-geopandas"><span class="header-section-number">2.3</span> Analyzing vector data with GeoPandas</h3>
<p><code>geopandas</code> provides a simple, intuitive for the main types of geospatial vector file formats</p>
<p><img src="imgs/geopandas-logo.jpeg" class="img-fluid" width="600"></p>
<div id="cell-14" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="3">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The import statement</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Example:</strong> Let’s load a shape file of countries in the world…</p>
<p><a href="http://www.naturalearthdata.com/downloads/110m-cultural-vectors/110m-admin-0-countries/">Source: Natural Earth Data</a></p>
<p>We can use the <a href="https://geopandas.org/docs/reference/api/geopandas.read_file.html">read_file()</a> function to read shapefiles and GeoJSON files.</p>
<div id="cell-17" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="4">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the shape file, giving the name of the directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(<span class="st">"./data/ne_110m_admin_0_countries"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-18" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="5">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>countries.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AFG</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>34124811.0</td>
<td>64080.0</td>
<td>POLYGON ((61.21082 35.65007, 62.23065 35.27066...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ALB</td>
<td>Albania</td>
<td>Europe</td>
<td>3047987.0</td>
<td>33900.0</td>
<td>POLYGON ((21.02004 40.84273, 20.99999 40.58000...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARE</td>
<td>United Arab Emirates</td>
<td>Asia</td>
<td>6072475.0</td>
<td>667200.0</td>
<td>POLYGON ((51.57952 24.24550, 51.75744 24.29407...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARG</td>
<td>Argentina</td>
<td>South America</td>
<td>44293293.0</td>
<td>879400.0</td>
<td>MULTIPOLYGON (((-66.95992 -54.89681, -67.56244...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-19" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="6">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
</section>
<section id="whats-a-geodataframe" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="whats-a-geodataframe"><span class="header-section-number">2.4</span> What’s a <code>GeoDataFrame</code>?</h3>
<p>Just like a <code>DataFrame</code> but with a new, special <code>geometry</code> column:</p>
<p><img src="imgs/geodataframe.svg"></p>
<p>Print out the first 10 entires of the “geometry” column:</p>
<div id="cell-24" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="7">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">"geometry"</span>].head(n<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0    POLYGON ((61.21082 35.65007, 62.23065 35.27066...
1    MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...
2    POLYGON ((21.02004 40.84273, 20.99999 40.58000...
3    POLYGON ((51.57952 24.24550, 51.75744 24.29407...
4    MULTIPOLYGON (((-66.95992 -54.89681, -67.56244...
5    POLYGON ((43.58275 41.09214, 44.97248 41.24813...
6    MULTIPOLYGON (((-59.57209 -80.04018, -59.86585...
7    POLYGON ((68.93500 -48.62500, 69.58000 -48.940...
8    MULTIPOLYGON (((145.39798 -40.79255, 146.36412...
9    POLYGON ((16.97967 48.12350, 16.90375 47.71487...
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
<p>Take a look at the first geometry polygon by using the <code>.iloc[]</code> selector:</p>
<div id="cell-26" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">'geometry'</span>].iloc[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-9-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="we-can-still-leverage-the-power-of-pandas" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="we-can-still-leverage-the-power-of-pandas"><span class="header-section-number">2.5</span> We can still leverage the power of <code>pandas</code>…</h3>
<p>Calculate the total world population:</p>
<div id="cell-29" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="9">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>countries[<span class="st">"pop_est"</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e9</span>  <span class="co"># In billions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>7.383089462</code></pre>
</div>
</div>
<p>Calculate the total population on each continent:</p>
<div id="cell-31" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="10">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> countries.groupby(<span class="st">"continent"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>grouped</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x3131a0190&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Remember">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Remember
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>groupby()</code> function does not return a <code>DataFrame</code> — you need to call <code>sum()</code>, <code>mean()</code> etc, or <code>apply()</code> a function to get your desired result!</p>
</div>
</div>
<p>Access the “pop_est” column from the groupby variable (“grouped”) and then call the <code>.sum()</code> function to calculate our desired statistic:</p>
<div id="cell-34" class="cell" data-tags="[]" data-execution_count="11">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pop_by_continent <span class="op">=</span> grouped[<span class="st">"pop_est"</span>].<span class="bu">sum</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pop_by_continent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>continent
Africa                     1.219176e+09
Antarctica                 4.050000e+03
Asia                       4.389145e+09
Europe                     7.463985e+08
North America              5.730421e+08
Oceania                    3.678284e+07
Seven seas (open ocean)    1.400000e+02
South America              4.185407e+08
Name: pop_est, dtype: float64</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="12">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort values</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>pop_by_continent.sort_values(ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Output sorted values from cell</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>pop_by_continent <span class="op">/</span> <span class="fl">1e9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>continent
Asia                       4.389145e+00
Africa                     1.219176e+00
Europe                     7.463985e-01
North America              5.730421e-01
South America              4.185407e-01
Oceania                    3.678284e-02
Antarctica                 4.050000e-06
Seven seas (open ocean)    1.400000e-07
Name: pop_est, dtype: float64</code></pre>
</div>
</div>
<p>Filter the data frame based on a boolean selection:</p>
<div id="cell-37" class="cell" data-tags="[]" data-execution_count="13">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is the country name USA?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>is_USA <span class="op">=</span> countries[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"United States of America"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>is_USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0      False
1      False
2      False
3      False
4      False
       ...  
172    False
173    False
174    False
175    False
176    False
Name: name, Length: 177, dtype: bool</code></pre>
</div>
</div>
<div id="cell-38" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="14">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the row with USA</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> countries.loc[is_USA]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">168</td>
<td>USA</td>
<td>United States of America</td>
<td>North America</td>
<td>326625791.0</td>
<td>18560000.0</td>
<td>MULTIPOLYGON (((-122.84000 49.00000, -120.0000...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-39" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#you can see the type is a shapely polygon object. Geopandas is </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># built on Shapely. We will talk more on this later</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>USA.squeeze().geometry, <span class="bu">type</span>(USA.squeeze().geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>(&lt;MULTIPOLYGON (((-122.84 49, -120 49, -117.031 49, -116.048 49, -113 49, -11...&gt;,
 shapely.geometry.multipolygon.MultiPolygon)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Reminder: the squeeze() function">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reminder: the squeeze() function
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>squeeze()</code> function does just one it sounds like: if you have a DataFrame with only one row, it will “squeeze” the row dimension by removing it, returning just a Series object:</p>
</div>
</div>
<div id="cell-41" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="17">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Squeeze</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> USA.squeeze()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the types</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The type of USA is: "</span>, <span class="bu">type</span>(USA))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The type of USA is:  &lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>iso_a3                                                      USA
name                                   United States of America
continent                                         North America
pop_est                                             326625791.0
gdp_md_est                                           18560000.0
geometry      MULTIPOLYGON (((-122.84000000000005 49.0000000...
Name: 168, dtype: object</code></pre>
</div>
</div>
<p>The simple features (Lines, Points, Polygons) are implemented by the <a href="https://shapely.readthedocs.io/en/stable/manual.html">shapely</a> library</p>
<div id="cell-43" class="cell" data-tags="[]" data-execution_count="18">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>iso_a3                                                      USA
name                                   United States of America
continent                                         North America
pop_est                                             326625791.0
gdp_md_est                                           18560000.0
geometry      MULTIPOLYGON (((-122.84000000000005 49.0000000...
Name: 168, dtype: object</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="19">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(USA.geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>shapely.geometry.multipolygon.MultiPolygon</code></pre>
</div>
</div>
<p>JupyterLab renders <code>shapely</code> geometries automatically:</p>
<div id="cell-46" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="19">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a mini USA</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>USA.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-20-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-does-geopandas-handle-coordinate-systems-and-map-projections" class="level3" data-number="2.6">
<h3 data-number="2.6" class="anchored" data-anchor-id="how-does-geopandas-handle-coordinate-systems-and-map-projections"><span class="header-section-number">2.6</span> How does <code>geopandas</code> handle coordinate systems and map projections?</h3>
<p>A <strong>coordinate reference system</strong> (CRS) relates the position of a geometry object on the spherical earth to its two-dimensional coordinates.</p>
<p>A <code>GeoDataFrame</code> or <code>GeoSeries</code> has a <code>.crs</code> attribute which specifies the coordinate reference system.</p>
<div id="cell-48" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="20">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>countries.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
</section>
<section id="the-epsg4326-crs" class="level3" data-number="2.7">
<h3 data-number="2.7" class="anchored" data-anchor-id="the-epsg4326-crs"><span class="header-section-number">2.7</span> The EPSG=4326 CRS</h3>
<ul>
<li>EPSG 4326 is known as WGS 84 where <code>x</code> and <code>y</code> are longitude and latitude.</li>
<li>It is is the default coordinate system for GPS systems.</li>
<li>It’s also known as <em>Plate Carrée</em> or <em>equirectangular</em></li>
</ul>
</section>
<section id="how-to-plot-all-of-the-geometries-at-once" class="level3" data-number="2.8">
<h3 data-number="2.8" class="anchored" data-anchor-id="how-to-plot-all-of-the-geometries-at-once"><span class="header-section-number">2.8</span> How to plot all of the geometries at once?</h3>
<p>Use the <code>plot()</code> function to get a quick and dirty plot of all of the geometry features.</p>
<p><strong>Note:</strong> the <code>plot()</code> returns the current maplotlib axes, allowing you to format the chart after plotting.</p>
<div id="cell-51" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="21">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axes</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the countries on our axes</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> countries.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Equirectangular Projection"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-22-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<center>
<img src="imgs/equirectangular.png" width="800">
</center>
</section>
<section id="can-we-convert-to-other-coordinate-systems" class="level3" data-number="2.9">
<h3 data-number="2.9" class="anchored" data-anchor-id="can-we-convert-to-other-coordinate-systems"><span class="header-section-number">2.9</span> Can we convert to other coordinate systems?</h3>
<p>Use the <code>df.to_crs()</code> function! The most well-known projections can be specified by their EPSG code.</p>
<p>Geopandas documentation on re-projecting: <a href="https://geopandas.org/projections.html#re-projecting">Managing Projections</a></p>
<section id="lets-convert-to-the-mercator-projection" class="level4" data-number="2.9.1">
<h4 data-number="2.9.1" class="anchored" data-anchor-id="lets-convert-to-the-mercator-projection"><span class="header-section-number">2.9.1</span> Let’s convert to the Mercator projection</h4>
<p><a href="http://spatialreference.org/ref/epsg/wgs-84-world-mercator/">EPSG code: 3395</a></p>
<div id="cell-55" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="22">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove Antartica, as the Mercator projection</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cannot deal with the poles</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>no_antarctica <span class="op">=</span> countries.loc[(countries[<span class="st">"name"</span>] <span class="op">!=</span> <span class="st">"Antarctica"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-56" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="23">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Two ways to specify the EPSG code</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>countries_mercator <span class="op">=</span> no_antarctica.to_crs(epsg<span class="op">=</span><span class="dv">3395</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># countries_mercator = no_antartica.to_crs("EPSG:3395")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-57" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="24">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>countries_mercator.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AFG</td>
<td>Afghanistan</td>
<td>Asia</td>
<td>34124811.0</td>
<td>64080.0</td>
<td>POLYGON ((6813956.990 4227673.562, 6927484.435...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((2660998.216 -1305442.810, 2680...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ALB</td>
<td>Albania</td>
<td>Europe</td>
<td>3047987.0</td>
<td>33900.0</td>
<td>POLYGON ((2339940.185 4961221.199, 2337708.178...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ARE</td>
<td>United Arab Emirates</td>
<td>Asia</td>
<td>6072475.0</td>
<td>667200.0</td>
<td>POLYGON ((5741805.754 2765811.385, 5761611.935...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>ARG</td>
<td>Argentina</td>
<td>South America</td>
<td>44293293.0</td>
<td>879400.0</td>
<td>MULTIPOLYGON (((-7453944.198 -7306880.704, -75...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take a look at the values in the “geometry” column above. The magnitude of the coordinates changed! This is a quick and easy way to tell if the re-projection worked properly!</p>
</div>
</div>
</section>
<section id="now-lets-plot-it" class="level4" data-number="2.9.2">
<h4 data-number="2.9.2" class="anchored" data-anchor-id="now-lets-plot-it"><span class="header-section-number">2.9.2</span> Now let’s plot it!</h4>
<p>The easy way…with geopandas built-in <code>plot()</code> function</p>
<div id="cell-60" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="25">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the figure and axes</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use built-in plot() of the GeoDataFrame</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> countries_mercator.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Mercator Projection"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<center>
<img src="imgs/mercator.png" width="800">
</center>
</section>
<section id="which-one-is-your-favorite" class="level4" data-number="2.9.3">
<h4 data-number="2.9.3" class="anchored" data-anchor-id="which-one-is-your-favorite"><span class="header-section-number">2.9.3</span> Which one is your favorite?</h4>
<p><img src="https://imgs.xkcd.com/comics/map_projections.png" class="img-fluid"></p>
<p><a href="https://xkcd.com/977/">Source: xkcd</a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tip: Choosing the right CRS">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: Choosing the right CRS
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>For city-based data, the Web Mercator CRS (<a href="https://epsg.io/3857">EPSG=3857</a>) is best. This CRS became popular after Google Maps adopted it.</li>
<li>You can also use a CRS specific to individual states, e.g., the <a href="https://epsg.io/2272">PA State Plane EPSG=2272</a> is a good option for Philadelphia</li>
</ul>
</div>
</div>
</section>
</section>
<section id="lets-load-the-city-limits-for-philadelphia" class="level3" data-number="2.10">
<h3 data-number="2.10" class="anchored" data-anchor-id="lets-load-the-city-limits-for-philadelphia"><span class="header-section-number">2.10</span> Let’s load the city limits for Philadelphia</h3>
<p>We’ll use the provided <code>City_Limits</code> shape file in the <code>data/</code> folder</p>
<div id="cell-65" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="26">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>city_limits <span class="op">=</span> gpd.read_file(<span class="st">"./data/City_Limits"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>city_limits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">Shape__Are</th>
<th data-quarto-table-cell-role="th">Shape__Len</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.038911</td>
<td>1.259687</td>
<td>POLYGON ((-75.01497 40.13793, -75.01456 40.137...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="whats-the-crs" class="level4" data-number="2.10.1">
<h4 data-number="2.10.1" class="anchored" data-anchor-id="whats-the-crs"><span class="header-section-number">2.10.1</span> What’s the CRS?</h4>
<p>Use the <code>.crs</code> attribute to find out!</p>
<div id="cell-67" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="27">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>city_limits.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Plot it with the EPSG=4326 CRS:</p>
<div id="cell-69" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="28">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our figure and axes</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>city_limits.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Format</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Equirectangular"</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()  <span class="co"># This will remove the axes completely</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)  <span class="co"># This forces an equal aspect ratio</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This is <em>not</em> what Philadelphia looks like..</p>
<p>Let’s try EPSG=3857 instead:</p>
<div id="cell-71" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="29">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the figure</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to EPSG:3857</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>city_limits_3857 <span class="op">=</span> city_limits.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot and format</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>city_limits_3857.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Web Mercator"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The equirectangular CRS (EPSG=4326) is often used by default and will make cities appear wider and flatter than they really are.</p>
</div>
</div>
</section>
<section id="saving-geodataframes" class="level4" data-number="2.10.2">
<h4 data-number="2.10.2" class="anchored" data-anchor-id="saving-geodataframes"><span class="header-section-number">2.10.2</span> Saving GeoDataFrames</h4>
<p>Use the <code>to_file()</code> function and specify the driver.</p>
<div id="cell-74" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ESRI shape file</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_file(<span class="st">"./data/city_limits_3857"</span>, driver<span class="op">=</span><span class="st">"Shapefile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-75" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GeoJSON is also an option</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_file(<span class="st">"./data/city_limits_3857.geojson"</span>, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="how-about-as-a-csv-file" class="level4" data-number="2.10.3">
<h4 data-number="2.10.3" class="anchored" data-anchor-id="how-about-as-a-csv-file"><span class="header-section-number">2.10.3</span> How about as a CSV file?</h4>
<p>Yes, but reading requires more work…</p>
<div id="cell-77" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save a csv file</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>city_limits_3857.to_csv(<span class="st">"./data/city_limits_3857.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-78" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"./data/city_limits_3857.csv"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">Shape__Are</th>
<th data-quarto-table-cell-role="th">Shape__Len</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0.038911</td>
<td>1.259687</td>
<td>POLYGON ((-8350627.97509646 4886006.88680784, ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="looks-similar" class="level4" data-number="2.10.4">
<h4 data-number="2.10.4" class="anchored" data-anchor-id="looks-similar"><span class="header-section-number">2.10.4</span> Looks similar…</h4>
<p><strong>But,</strong> the “geometry” column is just stored as a string…it’s not a shapely Polygon</p>
<div id="cell-80" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="32">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0    POLYGON ((-8350627.97509646 4886006.88680784, ...
Name: geometry, dtype: object</code></pre>
</div>
</div>
</section>
<section id="use-shapely-to-parse-the-string-version-of-the-polygons" class="level4" data-number="2.10.5">
<h4 data-number="2.10.5" class="anchored" data-anchor-id="use-shapely-to-parse-the-string-version-of-the-polygons"><span class="header-section-number">2.10.5</span> Use <code>shapely</code> to parse the string version of the polygons</h4>
<div id="cell-82" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely <span class="im">import</span> wkt</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># wkt.loads will convert from string to Polygon object</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"geometry"</span>] <span class="op">=</span> df[<span class="st">"geometry"</span>].<span class="bu">apply</span>(wkt.loads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-83" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="34">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.geometry.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-37-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Success!</p>
</section>
<section id="converting-from-a-dataframe-to-a-geodataframe" class="level4" data-number="2.10.6">
<h4 data-number="2.10.6" class="anchored" data-anchor-id="converting-from-a-dataframe-to-a-geodataframe"><span class="header-section-number">2.10.6</span> Converting from a DataFrame to a GeoDataFrame</h4>
<p>We can initialize the GeoDataFrame directly from a DataFrame but we need to specify <strong>two things</strong>:</p>
<ol type="1">
<li>The name of the “geometry” column</li>
<li>The CRS of the “geometry” column</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Watch out!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Watch out!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The CRS that you specify when you create the GeoDataFrame must match the CRS of the data. It is <strong>not</strong> the CRS that you wish the data was in. If you would like to convert to a different CRS, you’ll need to call the <code>.to_crs()</code> after creating your GeoDataFrame.</p>
</div>
</div>
<p>In this case, the geometry column was saved in Web Mercator EPSG=3857</p>
<div id="cell-87" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make specifying the name of the geometry column and CRS</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:3857"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now plot</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lets-convert-back-to-4326-and-plot" class="level4" data-number="2.10.7">
<h4 data-number="2.10.7" class="anchored" data-anchor-id="lets-convert-back-to-4326-and-plot"><span class="header-section-number">2.10.7</span> Let’s convert back to 4326 and plot</h4>
<p>The tilt should be a bit more obvious now…</p>
<div id="cell-89" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="36">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.to_crs(epsg<span class="op">=</span><span class="dv">4326</span>).plot(facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>I didn’t use <code>plt.subplots()</code> here to create a figure/axes – I let geopandas automatically make one</li>
<li>I’ve chained together the <code>to_crs()</code> and <code>.plot()</code> functions in one line</li>
<li>The <code>.plot()</code> function returns the axes object that geopandas used to plot —&nbsp;this lets you customizes the axes after plotting</li>
</ul>
</div>
</div>
</section>
</section>
<section id="so-when-should-you-use-geopandas" class="level3" data-number="2.11">
<h3 data-number="2.11" class="anchored" data-anchor-id="so-when-should-you-use-geopandas"><span class="header-section-number">2.11</span> So, when should you use GeoPandas?</h3>
<ul>
<li>For exploratory data analysis and visualization, including in Jupyter notebooks</li>
<li>Pre-processing data to be fed into a desktop GIS program</li>
<li>For compact, readable, and reproducible code</li>
<li>If you’re comfortable with Pandas and/or R data frames.</li>
</ul>
</section>
<section id="when-it-may-not-be-the-best-tool" class="level3" data-number="2.12">
<h3 data-number="2.12" class="anchored" data-anchor-id="when-it-may-not-be-the-best-tool"><span class="header-section-number">2.12</span> When it may not be the best tool:</h3>
<ul>
<li>For polished multilayer map creation — one option is to use a desktop GIS like QGIS.</li>
<li>If you need very high performance —&nbsp;geopandas can be slow compared to other GIS software.</li>
</ul>
</section>
</section>
<section id="part-2-spatial-relationships-and-joins" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="part-2-spatial-relationships-and-joins"><span class="header-section-number">3</span> Part 2: Spatial Relationships and Joins</h2>
<p>Let’s explore joins and merges between GeoDataFrames based on geospatial relationships…</p>
<div id="cell-94" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="37">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load some cities data from the data/ folder</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> gpd.read_file(<span class="st">"./data/ne_110m_populated_places"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-95" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vaduz</td>
<td>POINT (9.51667 47.13372)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Lobamba</td>
<td>POINT (31.20000 -26.46667)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Luxembourg</td>
<td>POINT (6.13000 49.61166)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">238</td>
<td>Rio de Janeiro</td>
<td>POINT (-43.22697 -22.92308)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">239</td>
<td>São Paulo</td>
<td>POINT (-46.62697 -23.55673)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">240</td>
<td>Sydney</td>
<td>POINT (151.18323 -33.91807)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">241</td>
<td>Singapore</td>
<td>POINT (103.85387 1.29498)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">242</td>
<td>Hong Kong</td>
<td>POINT (114.18306 22.30693)</td>
</tr>
</tbody>
</table>

<p>243 rows × 2 columns</p>
</div>
</div>
</div>
<center>
<img src="imgs/spatial-relationships.png" width="600">
</center>
<p>(Image by <a href="https://en.wikipedia.org/wiki/Spatial_relation#/media/File:TopologicSpatialRelarions2.png">Krauss, CC BY-SA 3.0</a>)</p>
<p>All of these operations are available as functions of a <code>GeoDataFrame</code>.</p>
<section id="a-quick-example" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="a-quick-example"><span class="header-section-number">3.1</span> A quick example</h3>
<p>What country is New York in?</p>
<p><strong>Spoiler</strong>: the USA</p>
<div id="cell-99" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="39">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the Point representing New York City</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> cities.loc[cities[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"New York"</span>].geometry.squeeze()</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>new_york</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-42-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-100" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="40">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(new_york)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>shapely.geometry.point.Point</code></pre>
</div>
</div>
<div id="cell-101" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="41">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>countries.contains(new_york)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0      False
1      False
2      False
3      False
4      False
       ...  
172    False
173    False
174    False
175    False
176    False
Length: 177, dtype: bool</code></pre>
</div>
</div>
<div id="cell-102" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="42">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the country that contains New York</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>countries.loc[countries.contains(new_york)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">168</td>
<td>USA</td>
<td>United States of America</td>
<td>North America</td>
<td>326625791.0</td>
<td>18560000.0</td>
<td>MULTIPOLYGON (((-122.84000 49.00000, -120.0000...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-103" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="43">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the geometry column of the country containing NYC</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>USA <span class="op">=</span> countries.loc[countries.contains(new_york)].squeeze().geometry</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-46-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>.loc[]</code> function can take the index selector as the first argument, and the name of a column as a second argument (separated by a comma)</p>
</div>
</div>
<div id="cell-105" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="44">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(USA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>shapely.geometry.multipolygon.MultiPolygon</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="45">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is New York within the USA?</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>new_york.within(USA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-107" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>USA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-49-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="references" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="references"><span class="header-section-number">3.2</span> References</h3>
<p>The different functions for checking spatial relationships:</p>
<ul>
<li><code>equals</code></li>
<li><code>contains</code></li>
<li><code>crosses</code></li>
<li><code>disjoint</code></li>
<li><code>intersects</code></li>
<li><code>overlaps</code></li>
<li><code>touches</code></li>
<li><code>within</code></li>
<li><code>covers</code></li>
</ul>
<p>See <a href="https://shapely.readthedocs.io/en/stable/manual.html#predicates-and-relationships">the shapely documentation</a> for an overview of these methods.</p>
</section>
<section id="the-spatial-join-sjoin" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="the-spatial-join-sjoin"><span class="header-section-number">3.3</span> 1. The spatial join: <code>sjoin()</code></h3>
<p><strong>SPATIAL JOIN</strong> = merging attributes from two geometry layers based on their spatial relationship</p>
<p>Different parts of this operations:</p>
<ul>
<li>The GeoDataFrame to which we want add information</li>
<li>The GeoDataFrame that contains the information we want to add</li>
<li>The spatial relationship we want to use to match both datasets (<strong>intersects</strong>, <strong>contains</strong>, <strong>within</strong>)</li>
<li>The type of join: <strong>left</strong> or <strong>inner</strong> join</li>
</ul>
<p>In this case, we want to join the <code>cities</code> dataframe, containing <code>Point</code> geometries, with the information of the <code>countries</code> dataframe, containing <code>Polygon</code> geometries.</p>
<p>To match cities with countries, we’ll use the <code>within</code> spatial relationship.</p>
<p>The <a href="https://geopandas.org/reference/geopandas.sjoin.html"><code>geopandas.sjoin()</code></a> function performs this operation:</p>
<div id="cell-111" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="47">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>joined <span class="op">=</span> gpd.sjoin(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    cities,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    countries,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    predicate<span class="op">=</span><span class="st">"within"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    lsuffix<span class="op">=</span><span class="st">"city"</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    rsuffix<span class="op">=</span><span class="st">"country"</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-112" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="48">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>joined.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name_city</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_country</th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name_country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Vaduz</td>
<td>POINT (9.51667 47.13372)</td>
<td>9.0</td>
<td>AUT</td>
<td>Austria</td>
<td>Europe</td>
<td>8754413.0</td>
<td>416600.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Lobamba</td>
<td>POINT (31.20000 -26.46667)</td>
<td>152.0</td>
<td>SWZ</td>
<td>Swaziland</td>
<td>Africa</td>
<td>1467152.0</td>
<td>11060.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Luxembourg</td>
<td>POINT (6.13000 49.61166)</td>
<td>97.0</td>
<td>LUX</td>
<td>Luxembourg</td>
<td>Europe</td>
<td>594130.0</td>
<td>58740.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see above, the attributes of the cities (left) and countries (right) have been merged based on whether the city is inside the country.</p>
<p>Let’s select cities in Italy only:</p>
<div id="cell-115" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>cities_in_italy <span class="op">=</span> joined.loc[joined[<span class="st">"name_country"</span>] <span class="op">==</span> <span class="st">"Italy"</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>cities_in_italy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name_city</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_country</th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name_country</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Vatican City</td>
<td>POINT (12.45339 41.90328)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>San Marino</td>
<td>POINT (12.44177 43.93610)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">226</td>
<td>Rome</td>
<td>POINT (12.48131 41.89790)</td>
<td>79.0</td>
<td>ITA</td>
<td>Italy</td>
<td>Europe</td>
<td>62137802.0</td>
<td>2221000.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-116" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="50">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Italy</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>italy <span class="op">=</span> countries.loc[countries[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"Italy"</span>]</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>italy.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the first city in the joined data frame (Vatican City)</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the same axes by passing in the ax=ax keyword</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> cities_in_italy.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-overlay-operation-overlay" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="spatial-overlay-operation-overlay"><span class="header-section-number">3.4</span> 2. Spatial overlay operation: <code>overlay()</code></h3>
<p>We can also perform the “join” operation on the <strong>geometries</strong> rather than just combining <strong>attributes</strong>.</p>
<p>The <code>overlay()</code> function combines geometries, e.g.&nbsp;by taking the intersection of the geometries.</p>
<p>Select all countries in Africa:</p>
<div id="cell-119" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="51">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>africa <span class="op">=</span> countries.loc[countries[<span class="st">"continent"</span>] <span class="op">==</span> <span class="st">"Africa"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-120" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="52">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>africa.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((23.90415 -11.72228, 24.07991 -...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>BDI</td>
<td>Burundi</td>
<td>Africa</td>
<td>11466756.0</td>
<td>7892.0</td>
<td>POLYGON ((29.34000 -4.49998, 29.27638 -3.29391...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>BEN</td>
<td>Benin</td>
<td>Africa</td>
<td>11038805.0</td>
<td>24310.0</td>
<td>POLYGON ((2.69170 6.25882, 1.86524 6.14216, 1....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>BFA</td>
<td>Burkina Faso</td>
<td>Africa</td>
<td>20107509.0</td>
<td>32990.0</td>
<td>POLYGON ((2.15447 11.94015, 1.93599 11.64115, ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>BWA</td>
<td>Botswana</td>
<td>Africa</td>
<td>2214858.0</td>
<td>35900.0</td>
<td>POLYGON ((29.43219 -22.09131, 28.01724 -22.827...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What is the CRS?</p>
<div id="cell-122" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="53">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>africa.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div id="cell-123" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="54">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's transform to a CRS that uses meters</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of degrees (EPSG=3857)</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>africa <span class="op">=</span> africa.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>africa.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>&lt;Projected CRS: EPSG:3857&gt;
Name: WGS 84 / Pseudo-Mercator
Axis Info [cartesian]:
- X[east]: Easting (metre)
- Y[north]: Northing (metre)
Area of Use:
- name: World between 85.06°S and 85.06°N.
- bounds: (-180.0, -85.06, 180.0, 85.06)
Coordinate Operation:
- name: Popular Visualisation Pseudo-Mercator
- method: Popular Visualisation Pseudo Mercator
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>Plot it:</p>
<div id="cell-125" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="55">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>africa.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-58-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-126" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="56">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Important CRS needs to match!</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cities_3857 <span class="op">=</span> cities.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-127" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="57">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of the GeoDataFrame</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>buffered_cities <span class="op">=</span> cities_3857.copy()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a buffer region of 250 km around all cities</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>buffered_cities[<span class="st">"geometry"</span>] <span class="op">=</span> buffered_cities.<span class="bu">buffer</span>(<span class="fl">250e3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="plot-the-difference-of-the-two-geometries" class="level4" data-number="3.4.1">
<h4 data-number="3.4.1" class="anchored" data-anchor-id="plot-the-difference-of-the-two-geometries"><span class="header-section-number">3.4.1</span> Plot the difference of the two geometries</h4>
<div id="cell-129" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="58">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the difference of the geometry sets</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> gpd.overlay(</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    africa,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    buffered_cities,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"difference"</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>diff.plot(facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-61-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-130" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="59">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data attributes are the same as the first data frame (africa)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with an updated geometry column</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>diff.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">iso_a3</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">pop_est</th>
<th data-quarto-table-cell-role="th">gdp_md_est</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AGO</td>
<td>Angola</td>
<td>Africa</td>
<td>29310273.0</td>
<td>189000.0</td>
<td>MULTIPOLYGON (((2673464.087 -1449571.330, 2441...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BEN</td>
<td>Benin</td>
<td>Africa</td>
<td>11038805.0</td>
<td>24310.0</td>
<td>POLYGON ((100138.898 1231805.081, 138422.412 1...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>BFA</td>
<td>Burkina Faso</td>
<td>Africa</td>
<td>20107509.0</td>
<td>32990.0</td>
<td>MULTIPOLYGON (((100138.898 1231805.081, 26368....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>BWA</td>
<td>Botswana</td>
<td>Africa</td>
<td>2214858.0</td>
<td>35900.0</td>
<td>POLYGON ((3065120.801 -2659823.621, 3061281.52...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CAF</td>
<td>Central African Rep.</td>
<td>Africa</td>
<td>5625118.0</td>
<td>3206.0</td>
<td>POLYGON ((1792937.514 836963.765, 1813457.017 ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-the-intersection-of-the-two-geometries" class="level4" data-number="3.4.2">
<h4 data-number="3.4.2" class="anchored" data-anchor-id="plot-the-intersection-of-the-two-geometries"><span class="header-section-number">3.4.2</span> Plot the intersection of the two geometries</h4>
<div id="cell-132" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="60">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The intersection of the geometry sets</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>intersection <span class="op">=</span> gpd.overlay(africa, buffered_cities, how<span class="op">=</span><span class="st">"intersection"</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>intersection.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"#b9f2b1"</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">"equal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-63-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="recap-spatial-operations" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="recap-spatial-operations"><span class="header-section-number">3.5</span> Recap: spatial operations</h3>
<ul>
<li><strong>Spatial join</strong>: merge attributes from one data frame to another based on the spatial relationship</li>
<li><strong>Spatial overlay</strong>: creating new geometries based on spatial operation between both data frames (and not combining attributes of both data frames)</li>
</ul>
</section>
</section>
<section id="example-exploring-trash-related-311-tickets-by-neighborhood-in-2020" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="example-exploring-trash-related-311-tickets-by-neighborhood-in-2020"><span class="header-section-number">4</span> Example: Exploring trash-related 311 tickets by neighborhood in 2020</h2>
<p>Let’s test out our geospatial skills by exploring data for 311 requests in Philadelphia during the pandemic in 2020. We’ll get started by summarizing the data by month and then dive into examining trends by neighborhood.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Find out more...">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Find out more…
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trash collection was a big concern in Philadelphia when the pandemic began. Check out <a href="https://www.inquirer.com/news/philadephia-trash-recycling-collection-delays-covid-20200806.html">this article</a> in the Philadelphia Inquirer for more details!</p>
</div>
</div>
<p>First, let’s load our data from the <code>data/</code> folder. I downloaded the data from <a href="https://www.opendataphilly.org/dataset/311-service-and-information-requests">OpenDataPhilly</a> for tickets from 2020 and trimmed to those requests that have been categorized as “Rubbish/Recyclable Material Collection”. These are tickets related to missed trash pickup by the City’s Streets Department.</p>
<div id="cell-136" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="61">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data from a CSV file into a pandas DataFrame</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>trash_requests_df <span class="op">=</span> pd.read_csv(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/trash_311_requests_2020.csv"</span>,  <span class="co"># Use the file path relative to the current folder</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-137" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="62">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of requests = "</span>, <span class="bu">len</span>(trash_requests_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of requests =  47730</code></pre>
</div>
</div>
<div id="cell-138" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="63">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">service_request_id</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">status_notes</th>
<th data-quarto-table-cell-role="th">service_name</th>
<th data-quarto-table-cell-role="th">service_code</th>
<th data-quarto-table-cell-role="th">agency_responsible</th>
<th data-quarto-table-cell-role="th">service_notice</th>
<th data-quarto-table-cell-role="th">requested_datetime</th>
<th data-quarto-table-cell-role="th">updated_datetime</th>
<th data-quarto-table-cell-role="th">expected_datetime</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">media_url</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8180042</td>
<td>13269656</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 19:22:24</td>
<td>2020-04-06 07:02:57</td>
<td>2020-04-06 20:00:00</td>
<td>624 FOULKROD ST</td>
<td>NaN</td>
<td>NaN</td>
<td>40.034389</td>
<td>-75.106518</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8180043</td>
<td>13266979</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 08:40:53</td>
<td>2020-04-06 07:02:58</td>
<td>2020-04-05 20:00:00</td>
<td>1203 ELLSWORTH ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.936164</td>
<td>-75.163497</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7744426</td>
<td>13066443</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-02 19:17:55</td>
<td>2020-01-04 05:46:06</td>
<td>2020-01-06 19:00:00</td>
<td>9054 WESLEYAN RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.058737</td>
<td>-75.018345</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7744427</td>
<td>13066540</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-03 07:01:46</td>
<td>2020-01-04 05:46:07</td>
<td>2020-01-06 19:00:00</td>
<td>2784 WILLITS RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.063658</td>
<td>-75.022347</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7801094</td>
<td>13089345</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-15 13:22:14</td>
<td>2020-01-16 14:03:29</td>
<td>2020-01-16 19:00:00</td>
<td>6137 LOCUST ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.958186</td>
<td>-75.244732</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="first-convert-to-a-geodataframe" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="first-convert-to-a-geodataframe"><span class="header-section-number">4.1</span> First, convert to a GeoDataFrame</h3>
<p>Remove the requests missing lat/lon coordinates</p>
<div id="cell-141" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="64">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df <span class="op">=</span> trash_requests_df.dropna(subset<span class="op">=</span>[<span class="st">"lat"</span>, <span class="st">"lon"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Create Point objects for each <code>lat</code> and <code>lon</code> combination.</p>
<p>We can use the helper utility function: <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.points_from_xy.html"><code>geopandas.points_from_xy()</code></a></p>
<div id="cell-143" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="65">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.points_from_xy(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    trash_requests_df[<span class="st">"lon"</span>], trash_requests_df[<span class="st">"lat"</span>]</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-144" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="66">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>trash_requests_df[<span class="st">"geometry"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>0    POINT (-75.10652 40.03439)
1    POINT (-75.16350 39.93616)
2    POINT (-75.01835 40.05874)
3    POINT (-75.02235 40.06366)
4    POINT (-75.24473 39.95819)
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
<p>Now, let’s create our GeoDataFrame object.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Don’t forget to set the CRS manually!</li>
<li>The CRS you specify when creating a GeoDataFrame should tell geopandas what the coordinate system the input data is in.</li>
<li>Usually you will be reading lat/lng coordinates, and will need to specify the crs as EPSG code 4326</li>
<li>You should specify the crs as a string using the syntax: <code>ESPG:4326</code></li>
</ul>
</div>
</div>
<p>Since we’re only using a few EPSG codes in this course, you can usually tell what the CRS is by looking at the values in the Point() objects.</p>
<p>Philadelphia has a latitude of about 40 deg and longitude of about -75 deg.</p>
<p><strong>Our data must be in the usual lat/lng EPSG=4326!</strong></p>
<p><img src="imgs/lat-lng-point-example.png" class="img-fluid"></p>
<p>Finally, let’s create our GeoDataFrame:</p>
<div id="cell-148" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="67">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    trash_requests_df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="lets-plot-the-monthly-trash-requests" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="lets-plot-the-monthly-trash-requests"><span class="header-section-number">4.2</span> Let’s plot the monthly trash requests</h3>
<p>Let’s add some new columns based on the “requested_datetime”. Right now, this column is a string, denoted by the dtype “object” in pandas language:</p>
<div id="cell-150" class="cell" data-tags="[]" data-execution_count="68">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>0    2020-04-02 19:22:24
1    2020-04-02 08:40:53
2    2020-01-02 19:17:55
3    2020-01-03 07:01:46
4    2020-01-15 13:22:14
Name: requested_datetime, dtype: object</code></pre>
</div>
</div>
<p>We can now use the <code>pd.to_datetime()</code> function to convert to a column of special <code>Datetime</code> objects, which have all sorts of useful functionality.</p>
<div id="cell-152" class="cell" data-execution_count="69">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the requested datetime to a column of Datetime objects</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    trash_requests_gdf[<span class="st">"requested_datetime"</span>]</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-153" class="cell" data-tags="[]" data-execution_count="70">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>0   2020-04-02 19:22:24
1   2020-04-02 08:40:53
2   2020-01-02 19:17:55
3   2020-01-03 07:01:46
4   2020-01-15 13:22:14
Name: requested_datetime_dt, dtype: datetime64[ns]</code></pre>
</div>
</div>
<p><br></p>
<p>It looks like it worked! We have a “datetime64[ns]” dtype for our new column now.</p>
<p>Now that the column is a <code>Datetime</code> Series, it has a special “.dt” attribute. This attribute allows you to quickly extract out parts of the date, e.g., month, day, year, etc., as new columns.</p>
<p>For all of the possible options, see the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/series.html">API docs for pd.Series</a> — take a look at all of the entries that start with <code>pd.Series.dt</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tip: The strftime() function">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: The strftime() function
</div>
</div>
<div class="callout-body-container callout-body">
<p>For converting datetime objects to strings in a certain format, we can use the “strftime” function (<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.strftime.html">docs</a>). This uses a special syntax to convert the date object to a string with a specific format.</p>
<p><strong>Helpful reference</strong>: Use <a href="https://strftime.org/">this strftime guide</a> to look up the syntax!</p>
</div>
</div>
<div id="cell-156" class="cell" data-tags="[]" data-execution_count="71">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the .dt attribute to extract out the month integer (starting at 0)</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"month_int"</span>] <span class="op">=</span> trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].dt.month</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the month name too — this is what %B means - (use strftime.org to see the codes!)</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf[<span class="st">"month"</span>] <span class="op">=</span> trash_requests_gdf[<span class="st">"requested_datetime_dt"</span>].dt.strftime(<span class="st">"%B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-157" class="cell" data-tags="[]" data-execution_count="72">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>trash_requests_gdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">service_request_id</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">status_notes</th>
<th data-quarto-table-cell-role="th">service_name</th>
<th data-quarto-table-cell-role="th">service_code</th>
<th data-quarto-table-cell-role="th">agency_responsible</th>
<th data-quarto-table-cell-role="th">service_notice</th>
<th data-quarto-table-cell-role="th">requested_datetime</th>
<th data-quarto-table-cell-role="th">updated_datetime</th>
<th data-quarto-table-cell-role="th">expected_datetime</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">media_url</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">requested_datetime_dt</th>
<th data-quarto-table-cell-role="th">month_int</th>
<th data-quarto-table-cell-role="th">month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>8180042</td>
<td>13269656</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 19:22:24</td>
<td>2020-04-06 07:02:57</td>
<td>2020-04-06 20:00:00</td>
<td>624 FOULKROD ST</td>
<td>NaN</td>
<td>NaN</td>
<td>40.034389</td>
<td>-75.106518</td>
<td>POINT (-75.10652 40.03439)</td>
<td>2020-04-02 19:22:24</td>
<td>4</td>
<td>April</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8180043</td>
<td>13266979</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-04-02 08:40:53</td>
<td>2020-04-06 07:02:58</td>
<td>2020-04-05 20:00:00</td>
<td>1203 ELLSWORTH ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.936164</td>
<td>-75.163497</td>
<td>POINT (-75.16350 39.93616)</td>
<td>2020-04-02 08:40:53</td>
<td>4</td>
<td>April</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7744426</td>
<td>13066443</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-02 19:17:55</td>
<td>2020-01-04 05:46:06</td>
<td>2020-01-06 19:00:00</td>
<td>9054 WESLEYAN RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.058737</td>
<td>-75.018345</td>
<td>POINT (-75.01835 40.05874)</td>
<td>2020-01-02 19:17:55</td>
<td>1</td>
<td>January</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7744427</td>
<td>13066540</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-03 07:01:46</td>
<td>2020-01-04 05:46:07</td>
<td>2020-01-06 19:00:00</td>
<td>2784 WILLITS RD</td>
<td>NaN</td>
<td>NaN</td>
<td>40.063658</td>
<td>-75.022347</td>
<td>POINT (-75.02235 40.06366)</td>
<td>2020-01-03 07:01:46</td>
<td>1</td>
<td>January</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7801094</td>
<td>13089345</td>
<td>Closed</td>
<td>NaN</td>
<td>Rubbish/Recyclable Material Collection</td>
<td>SR-ST03</td>
<td>Streets Department</td>
<td>2 Business Days</td>
<td>2020-01-15 13:22:14</td>
<td>2020-01-16 14:03:29</td>
<td>2020-01-16 19:00:00</td>
<td>6137 LOCUST ST</td>
<td>NaN</td>
<td>NaN</td>
<td>39.958186</td>
<td>-75.244732</td>
<td>POINT (-75.24473 39.95819)</td>
<td>2020-01-15 13:22:14</td>
<td>1</td>
<td>January</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, let’s group by the month integer and month name, and get the size of the groups using the built-in <code>.size()</code> function of the groupby object:</p>
<div id="cell-159" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="73">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>totals_by_month <span class="op">=</span> trash_requests_gdf.groupby(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span>[<span class="st">"month_int"</span>, <span class="st">"month"</span>], as_index<span class="op">=</span><span class="va">False</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>).size()</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>totals_by_month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month_int</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>January</td>
<td>2710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>February</td>
<td>2067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>March</td>
<td>2460</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>April</td>
<td>5778</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>May</td>
<td>6572</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6</td>
<td>June</td>
<td>6485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>July</td>
<td>9627</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>8</td>
<td>August</td>
<td>4466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>9</td>
<td>September</td>
<td>1704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>10</td>
<td>October</td>
<td>1335</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>11</td>
<td>November</td>
<td>1729</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>12</td>
<td>December</td>
<td>2757</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I’ve used the <code>as_index=False</code> keyword to the <code>groupby()</code> function. This will force the <code>size()</code> function to return a DataFrame instead of having the <code>month</code> column as the index of the resulted groupby operation.</p>
<p>Remember, the columns you group by become the index of the aggregated DataFrame. I often like to have them as columns in the DataFrame instead — the <code>as_index=False</code> flag exists for exactly this problem.</p>
</div>
</div>
</section>
<section id="plot-a-bar-chart-with-seaborn" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="plot-a-bar-chart-with-seaborn"><span class="header-section-number">4.3</span> Plot a bar chart with seaborn</h3>
<p>For making static bar charts with Python, seaborn’s <a href="https://seaborn.pydata.org/generated/seaborn.barplot.html"><code>sns.barplot()</code></a> is usually the best option!</p>
<div id="cell-162" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="74">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize figure/axes</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot!</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"month_int"</span>,</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>totals_by_month,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2176d2"</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(totals_by_month[<span class="st">"month"</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/7g/px0llbj54z37p076r6853ggh0000gn/T/ipykernel_16623/3879603526.py:13: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(totals_by_month["month"]);</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-77-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reference-lets-improve-the-aesthetics-via-matplotlib" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="reference-lets-improve-the-aesthetics-via-matplotlib"><span class="header-section-number">4.4</span> Reference: Let’s improve the aesthetics via matplotlib</h3>
<p>The trend is clear in the previous chart, but can we do a better job with the aesthetics? Yes!</p>
<p>For reference, here is a common way to clean up charts in matplotlib:</p>
<div id="cell-164" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="75">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize figure/axes</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot!</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>totals_by_month,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#2176d2"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    order<span class="op">=</span>[</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"January"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"February"</span>,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"March"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"April"</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"May"</span>,</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"June"</span>,</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"July"</span>,</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"August"</span>,</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"September"</span>,</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"October"</span>,</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"November"</span>,</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"December"</span>,</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    zorder<span class="op">=</span><span class="dv">999</span>,  <span class="co"># Make sure the bar charts are on top of the grid</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove x/y axis labels</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">""</span>)</span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the yticks to go from 0 to 10,000 with 2,000 step</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(np.arange(<span class="dv">0</span>, <span class="fl">1e4</span> <span class="op">+</span> <span class="dv">1</span>, <span class="fl">2e3</span>))</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the ytick labels to use a comma and no decimal places</span></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="ss">f"</span><span class="sc">{</span>yval<span class="sc">:,.0f}</span><span class="ss">"</span> <span class="cf">for</span> yval <span class="kw">in</span> ax.get_yticks()])</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the xticks</span></span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>plt.setp(ax.get_xticklabels(), rotation<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a grid backgrou d</span></span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the top and right axes lines</span></span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"top"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">"right"</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title</span></span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a>ax.set_title(</span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Philadelphia's Trash-Related 311 Requests in 2020"</span>, weight<span class="op">=</span><span class="st">"bold"</span>, fontsize<span class="op">=</span><span class="dv">16</span></span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="week3-geospatial-data-concepts_files/figure-html/cell-78-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Takeaway:</strong> A huge spike in trash related tickets over the summer in 2020!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This example could come in handy for reference as you work on the second assignment, where you will need to create polished and clear visualizations using both matplotlib and seaborn.</p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>