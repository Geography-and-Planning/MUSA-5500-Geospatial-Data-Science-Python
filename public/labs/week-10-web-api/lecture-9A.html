<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 9A Getting Data, Part 2: Working with APIs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="lecture-9A_files/libs/clipboard/clipboard.min.js"></script>
<script src="lecture-9A_files/libs/quarto-html/quarto.js"></script>
<script src="lecture-9A_files/libs/quarto-html/popper.min.js"></script>
<script src="lecture-9A_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lecture-9A_files/libs/quarto-html/anchor.min.js"></script>
<link href="lecture-9A_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lecture-9A_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lecture-9A_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lecture-9A_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lecture-9A_files/libs/bootstrap/bootstrap-81e35ebdb4125010edbabe6010586085.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#part-1-introduction-to-apis" id="toc-part-1-introduction-to-apis" class="nav-link active" data-scroll-target="#part-1-introduction-to-apis"><span class="header-section-number">1</span> Part 1: Introduction to APIs</a>
  <ul class="collapse">
  <li><a href="#example-1-automated-data-feeds" id="toc-example-1-automated-data-feeds" class="nav-link" data-scroll-target="#example-1-automated-data-feeds"><span class="header-section-number">1.1</span> Example #1: Automated data feeds</a></li>
  <li><a href="#example-2-the-carto-api" id="toc-example-2-the-carto-api" class="nav-link" data-scroll-target="#example-2-the-carto-api"><span class="header-section-number">1.2</span> Example #2: The CARTO API</a></li>
  <li><a href="#example-3-geoservices" id="toc-example-3-geoservices" class="nav-link" data-scroll-target="#example-3-geoservices"><span class="header-section-number">1.3</span> Example #3: GeoServices</a></li>
  </ul></li>
  <li><a href="#part-2-natural-language-processing-and-the-311-request-api" id="toc-part-2-natural-language-processing-and-the-311-request-api" class="nav-link" data-scroll-target="#part-2-natural-language-processing-and-the-311-request-api"><span class="header-section-number">2</span> Part 2: Natural Language Processing and the 311 Request API</a>
  <ul class="collapse">
  <li><a href="#semi-structured-data" id="toc-semi-structured-data" class="nav-link" data-scroll-target="#semi-structured-data"><span class="header-section-number">2.1</span> Semi-structured data</a></li>
  <li><a href="#key-challenges" id="toc-key-challenges" class="nav-link" data-scroll-target="#key-challenges"><span class="header-section-number">2.2</span> Key challenges</a></li>
  <li><a href="#use-case-1-calculating-word-frequencies" id="toc-use-case-1-calculating-word-frequencies" class="nav-link" data-scroll-target="#use-case-1-calculating-word-frequencies"><span class="header-section-number">2.3</span> Use case #1: calculating word frequencies</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 9A<br>Getting Data, Part 2: Working with APIs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Week #7 Agenda</strong></p>
<ul>
<li>Introduction to APIs</li>
<li>Natural language processing via Philly’s 311 API
<ul>
<li>Word frequencies</li>
<li>Sentiment analysis</li>
</ul></li>
<li>Pulling census data and shape files using Python</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Update your local environment!</p>
<ul>
<li>Small update to the course’s Python environment</li>
<li>Update the environment on your laptop using <a href="https://musa-550-fall-2023.github.io/resource/mamba.html#updating-an-existing-environment">these instructions</a> on course website</li>
</ul>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install holoviews</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install hvplot</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install seaborn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-5" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> holoviews <span class="im">as</span> hv</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hvplot.pandas</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<script type="esms-options">{"shimMode": true}</script><style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
  > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style>
</div>
<div class="cell-output cell-output-display">
<script type="application/javascript">
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;
  const py_version = '3.7.3'.replace('rc', '-rc.').replace('.dev', '-dev.');
  const reloading = false;
  const Bokeh = root.Bokeh;

  // Set a timeout for this load but only if we are not already initializing
  if (typeof (root._bokeh_timeout) === "undefined" || (force || !root._bokeh_is_initializing)) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      // Don't load bokeh if it is still initializing
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    } else if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      // There is nothing to load
      run_callbacks();
      return null;
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error(e) {
      const src_el = e.srcElement
      console.error("failed to load " + (src_el.href || src_el.src));
    }

    const skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {}, 'shim': {}});
      root._bokeh_is_loading = css_urls.length + 0;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    const existing_stylesheets = []
    const links = document.getElementsByTagName('link')
    for (let i = 0; i < links.length; i++) {
      const link = links[i]
      if (link.href != null) {
        existing_stylesheets.push(link.href)
      }
    }
    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const escaped = encodeURI(url)
      if (existing_stylesheets.indexOf(escaped) !== -1) {
        on_load()
        continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    var existing_scripts = []
    const scripts = document.getElementsByTagName('script')
    for (let i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
        existing_scripts.push(script.src)
      }
    }
    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (let i = 0; i < js_modules.length; i++) {
      const url = js_modules[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      const url = js_exports[name];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) >= 0 || root[name] != null) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.7.5/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.7.3.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.7.3.min.js", "https://cdn.holoviz.org/panel/1.7.5/dist/panel.min.js"];
  const js_modules = [];
  const js_exports = {};
  const css_urls = [];
  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (let i = 0; i < inline_js.length; i++) {
        try {
          inline_js[i].call(root, root.Bokeh);
        } catch(e) {
          if (!reloading) {
            throw e;
          }
        }
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
        var NewBokeh = root.Bokeh;
        if (Bokeh.versions === undefined) {
          Bokeh.versions = new Map();
        }
        if (NewBokeh.version !== Bokeh.version) {
          Bokeh.versions.set(NewBokeh.version, NewBokeh)
        }
        root.Bokeh = Bokeh;
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      // If the timeout and bokeh was not successfully loaded we reset
      // everything and try loading again
      root._bokeh_timeout = Date.now() + 5000;
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      root._bokeh_is_loading = 0
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      const bokeh_loaded = root.Bokeh != null && (root.Bokeh.version === py_version || (root.Bokeh.versions !== undefined && root.Bokeh.versions.has(py_version)));
      if (!reloading && !bokeh_loaded) {
        if (root.Bokeh) {
          root.Bokeh = undefined;
        }
        console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
        console.debug("Bokeh: BokehJS plotting callback run at", now());
        run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/javascript">

if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        let retries = 0;
        const open = () => {
          if (comm.active) {
            comm.open();
          } else if (retries > 3) {
            console.warn('Comm target never activated')
          } else {
            retries += 1
            setTimeout(open, 500)
          }
        }
        if (comm.active) {
          comm.open();
        } else {
          setTimeout(open, 500)
        }
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        })
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();
    


var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}

</script>
</div>
<div class="cell-output cell-output-display">
<div id="6f93c40b-d916-4b83-97f6-d08ebd607d53">
  <div id="e57e301f-3392-49dc-b1ea-c9d88f2eb9f8" data-root-id="6f93c40b-d916-4b83-97f6-d08ebd607d53" style="display: contents;"></div>
</div>
<script type="application/javascript">(function(root) {
  var docs_json = {"58e87949-b6ca-4b27-8e62-874d57896a6d":{"version":"3.7.3","title":"Bokeh Application","roots":[{"type":"object","name":"panel.models.browser.BrowserInfo","id":"6f93c40b-d916-4b83-97f6-d08ebd607d53"},{"type":"object","name":"panel.models.comm_manager.CommManager","id":"58afc3b0-4194-421e-9105-e5d35faff0b1","attributes":{"plot_id":"6f93c40b-d916-4b83-97f6-d08ebd607d53","comm_id":"64dd106418eb409abc5afc4814bd92e4","client_comm_id":"bd1c47f485dc45cfa21ce239f40f4e3b"}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"gap","kind":"Any","default":""},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"ReactiveESM1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"JSComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"ReactComponent1","properties":[{"name":"use_shadow_dom","kind":"Any","default":true},{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"AnyWidgetComponent1","properties":[{"name":"use_shadow_dom","kind":"Any","default":true},{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"max_notifications","kind":"Any","default":5},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_rendered","kind":"Any","default":false},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"TemplateEditor1","properties":[{"name":"layout","kind":"Any","default":[]}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"request_value1","properties":[{"name":"fill","kind":"Any","default":"none"},{"name":"_synced","kind":"Any","default":null},{"name":"_request_sync","kind":"Any","default":0}]},{"type":"model","name":"holoviews.plotting.bokeh.raster.HoverModel","properties":[{"name":"xy","kind":"Any","default":null},{"name":"data","kind":"Any","default":null}]}]}};
  var render_items = [{"docid":"58e87949-b6ca-4b27-8e62-874d57896a6d","roots":{"6f93c40b-d916-4b83-97f6-d08ebd607d53":"e57e301f-3392-49dc-b1ea-c9d88f2eb9f8"},"root_ids":["6f93c40b-d916-4b83-97f6-d08ebd607d53"]}];
  var docs = Object.values(docs_json)
  if (!docs) {
    return
  }
  const py_version = docs[0].version.replace('rc', '-rc.').replace('.dev', '-dev.')
  async function embed_document(root) {
    var Bokeh = get_bokeh(root)
    await Bokeh.embed.embed_items_notebook(docs_json, render_items);
    for (const render_item of render_items) {
      for (const root_id of render_item.root_ids) {
    const id_el = document.getElementById(root_id)
    if (id_el.children.length && id_el.children[0].hasAttribute('data-root-id')) {
      const root_el = id_el.children[0]
      root_el.id = root_el.id + '-rendered'
      for (const child of root_el.children) {
            // Ensure JupyterLab does not capture keyboard shortcuts
            // see: https://jupyterlab.readthedocs.io/en/4.1.x/extension/notebook.html#keyboard-interaction-model
        child.setAttribute('data-lm-suppress-shortcuts', 'true')
      }
    }
      }
    }
  }
  function get_bokeh(root) {
    if (root.Bokeh === undefined) {
      return null
    } else if (root.Bokeh.version !== py_version) {
      if (root.Bokeh.versions === undefined || !root.Bokeh.versions.has(py_version)) {
    return null
      }
      return root.Bokeh.versions.get(py_version);
    } else if (root.Bokeh.version === py_version) {
      return root.Bokeh
    }
    return null
  }
  function is_loaded(root) {
    var Bokeh = get_bokeh(root)
    return (Bokeh != null && Bokeh.Panel !== undefined)
  }
  if (is_loaded(root)) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (is_loaded(root)) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
      var Bokeh = get_bokeh(root)
      if (Bokeh == null || Bokeh.Panel == null) {
            console.warn("Panel: ERROR: Unable to run Panel code because Bokeh or Panel library is missing");
      } else {
        console.warn("Panel: WARNING: Attempting to render but not all required libraries could be resolved.")
        embed_document(root)
      }
        }
      }
    }, 25, root)
  }
})(window);</script>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show all columns</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">999</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="part-1-introduction-to-apis" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="part-1-introduction-to-apis"><span class="header-section-number">1</span> Part 1: Introduction to APIs</h2>
<p>Or, how to pull data from the web using Python</p>
<p><strong>Application programming interface (API):</strong></p>
<blockquote class="blockquote">
<p>(noun): A particular set of rules and specifications that software programs can follow to communicate with each other and exchange data.</p>
</blockquote>
<p><strong>Example APIs</strong></p>
<ul>
<li>Socrata Open Data: <a href="https://dev.socrata.com/">https://dev.socrata.com/</a></li>
<li>Open Data Philly: <a href="https://opendataphilly.org">https://opendataphilly.org</a></li>
<li>US Census Bureau: <a href="https://www.census.gov/data/developers/data-sets.html">https://www.census.gov/data/developers/data-sets.html</a></li>
<li>Bureau of Labor Statistics: <a href="https://www.bls.gov/developers/">https://www.bls.gov/developers/</a></li>
<li>US Geological Survey: <a href="https://www.usgs.gov/products/data-and-tools/apis">https://www.usgs.gov/products/data-and-tools/apis</a></li>
<li>US Environmental Protection Agency: <a href="https://www.epa.gov/enviro/web-services">https://www.epa.gov/enviro/web-services</a></li>
<li>Google APIs: <a href="https://console.cloud.google.com/apis/library">https://console.cloud.google.com/apis/library</a></li>
<li>Facebook: <a href="https://developers.facebook.com/docs/apis-and-sdks/">https://developers.facebook.com/docs/apis-and-sdks/</a></li>
<li>Twitter: <a href="https://developer.twitter.com/en/docs/api-reference-index">https://developer.twitter.com/en/docs/api-reference-index.html</a> (RIP 💀)</li>
<li>Foursquare: <a href="https://developer.foursquare.com/">https://developer.foursquare.com/</a></li>
<li>Instagram: <a href="https://www.instagram.com/developer/">https://www.instagram.com/developer/</a></li>
<li>Yelp: <a href="https://www.instagram.com/developer/">https://www.yelp.com/developers</a></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When accessing data via API, many services will require you to register an API key to prevent you from overloading the service with requests.</p>
</div>
</div>
<section id="example-1-automated-data-feeds" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="example-1-automated-data-feeds"><span class="header-section-number">1.1</span> Example #1: Automated data feeds</h3>
<p>The simplest form of API is when data providers maintain data files via a URL that are automatically updated with new data over time.</p>
<section id="usgs-real-time-earthquake-feeds" class="level4" data-number="1.1.1">
<h4 data-number="1.1.1" class="anchored" data-anchor-id="usgs-real-time-earthquake-feeds"><span class="header-section-number">1.1.1</span> USGS real-time earthquake feeds</h4>
<p>This is an API for near-real-time data about earthquakes, and data is provided in GeoJSON format over the web.</p>
<p>The API has a separate endpoint for each version of the data that users might want. No authentication is required.</p>
<p>API documentation:</p>
<p><a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php">http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php</a></p>
<p>Sample API endpoint, for magnitude 4.5+ earthquakes in past day:</p>
<p><a href="http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson">http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_day.geojson</a></p>
<p>GeoPandas can read GeoJSON files from the web directly. Simply pass the URL to the <code>gpd.read_file()</code> function:</p>
<div id="cell-15" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download data on magnitude 2.5+ quakes from the past week</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>endpoint_url <span class="op">=</span> (</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojson"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>earthquakes <span class="op">=</span> gpd.read_file(endpoint_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-16" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="34">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>earthquakes.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">mag</th>
<th data-quarto-table-cell-role="th">place</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">updated</th>
<th data-quarto-table-cell-role="th">tz</th>
<th data-quarto-table-cell-role="th">url</th>
<th data-quarto-table-cell-role="th">detail</th>
<th data-quarto-table-cell-role="th">felt</th>
<th data-quarto-table-cell-role="th">cdi</th>
<th data-quarto-table-cell-role="th">mmi</th>
<th data-quarto-table-cell-role="th">alert</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">tsunami</th>
<th data-quarto-table-cell-role="th">sig</th>
<th data-quarto-table-cell-role="th">net</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">ids</th>
<th data-quarto-table-cell-role="th">sources</th>
<th data-quarto-table-cell-role="th">types</th>
<th data-quarto-table-cell-role="th">nst</th>
<th data-quarto-table-cell-role="th">dmin</th>
<th data-quarto-table-cell-role="th">rms</th>
<th data-quarto-table-cell-role="th">gap</th>
<th data-quarto-table-cell-role="th">magType</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>us6000qys8</td>
<td>4.40</td>
<td>159 km SSW of Hihifo, Tonga</td>
<td>1754536150895</td>
<td>1754537779040</td>
<td>None</td>
<td>https://earthquake.usgs.gov/earthquakes/eventp...</td>
<td>https://earthquake.usgs.gov/earthquakes/feed/v...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>None</td>
<td>reviewed</td>
<td>0</td>
<td>298</td>
<td>us</td>
<td>6000qys8</td>
<td>,us6000qys8,</td>
<td>,us,</td>
<td>,origin,phase-data,</td>
<td>31.0</td>
<td>4.1930</td>
<td>0.90</td>
<td>90.0</td>
<td>mb</td>
<td>earthquake</td>
<td>M 4.4 - 159 km SSW of Hihifo, Tonga</td>
<td>POINT Z (-174.42110 -17.26250 163.49100)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>pr71491858</td>
<td>3.25</td>
<td>59 km ESE of Punta Cana, Dominican Republic</td>
<td>1754534626070</td>
<td>1754535661440</td>
<td>None</td>
<td>https://earthquake.usgs.gov/earthquakes/eventp...</td>
<td>https://earthquake.usgs.gov/earthquakes/feed/v...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>None</td>
<td>reviewed</td>
<td>0</td>
<td>162</td>
<td>pr</td>
<td>71491858</td>
<td>,pr71491858,</td>
<td>,pr,</td>
<td>,origin,phase-data,</td>
<td>11.0</td>
<td>0.6998</td>
<td>0.48</td>
<td>166.0</td>
<td>md</td>
<td>earthquake</td>
<td>M 3.3 - 59 km ESE of Punta Cana, Dominican Rep...</td>
<td>POINT Z (-67.84850 18.47550 7.24000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>us6000qys2</td>
<td>5.30</td>
<td>West Chile Rise</td>
<td>1754532765176</td>
<td>1754533931040</td>
<td>None</td>
<td>https://earthquake.usgs.gov/earthquakes/eventp...</td>
<td>https://earthquake.usgs.gov/earthquakes/feed/v...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>None</td>
<td>reviewed</td>
<td>0</td>
<td>432</td>
<td>us</td>
<td>6000qys2</td>
<td>,us6000qys2,</td>
<td>,us,</td>
<td>,origin,phase-data,</td>
<td>43.0</td>
<td>10.0980</td>
<td>1.19</td>
<td>138.0</td>
<td>mb</td>
<td>earthquake</td>
<td>M 5.3 - West Chile Rise</td>
<td>POINT Z (-83.88380 -41.84290 10.00000)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>us6000qyrr</td>
<td>4.70</td>
<td>220 km SE of Petropavlovsk-Kamchatsky, Russia</td>
<td>1754527874408</td>
<td>1754529752040</td>
<td>None</td>
<td>https://earthquake.usgs.gov/earthquakes/eventp...</td>
<td>https://earthquake.usgs.gov/earthquakes/feed/v...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>None</td>
<td>reviewed</td>
<td>0</td>
<td>340</td>
<td>us</td>
<td>6000qyrr</td>
<td>,us6000qyrr,</td>
<td>,us,</td>
<td>,origin,phase-data,</td>
<td>49.0</td>
<td>1.9480</td>
<td>0.66</td>
<td>128.0</td>
<td>mb</td>
<td>earthquake</td>
<td>M 4.7 - 220 km SE of Petropavlovsk-Kamchatsky,...</td>
<td>POINT Z (160.81000 51.59860 10.00000)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>us6000qyrp</td>
<td>4.50</td>
<td>164 km ESE of Petropavlovsk-Kamchatsky, Russia</td>
<td>1754527741225</td>
<td>1754529301040</td>
<td>None</td>
<td>https://earthquake.usgs.gov/earthquakes/eventp...</td>
<td>https://earthquake.usgs.gov/earthquakes/feed/v...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>None</td>
<td>reviewed</td>
<td>0</td>
<td>312</td>
<td>us</td>
<td>6000qyrp</td>
<td>,us6000qyrp,</td>
<td>,us,</td>
<td>,origin,phase-data,</td>
<td>37.0</td>
<td>1.4580</td>
<td>0.78</td>
<td>116.0</td>
<td>mb</td>
<td>earthquake</td>
<td>M 4.5 - 164 km ESE of Petropavlovsk-Kamchatsky...</td>
<td>POINT Z (160.92290 52.55490 10.00000)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s explore the data interactively with Folium:</p>
<div id="cell-18" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install folium matplotlib mapclassify</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install folium</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-19" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mapclassify <span class="im">import</span> classify</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-20" class="cell" data-tags="[]" data-execution_count="40">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># earthquakes.explore()</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># earthquakes.plot()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lots of other automated feeds available, updated every minute:</p>
<p><img src="imgs/usgs-1.png" class="img-fluid" width="312"> <img src="imgs/usgs-2.png" class="img-fluid" width="300"></p>
</section>
</section>
<section id="example-2-the-carto-api" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="example-2-the-carto-api"><span class="header-section-number">1.2</span> Example #2: The CARTO API</h3>
<ul>
<li>Philadelphia hosts the majority of its open data on OpenDataPhilly in the cloud using CARTO</li>
<li>They provide an API to download the data</li>
<li>You can access the API documentation on the dataset page on OpenDataPhilly</li>
</ul>
<p>For example: shooting victims in Philadelphia</p>
<p><a href="https://www.opendataphilly.org/dataset/shooting-victims">https://www.opendataphilly.org/dataset/shooting-victims</a></p>
<p>and the API documentation:</p>
<p><a href="https://cityofphiladelphia.github.io/carto-api-explorer/#shootings">https://cityofphiladelphia.github.io/carto-api-explorer/#shootings</a></p>
<p>Let’s take a look at the download URL for the data in the GeoJSON format:</p>
<p><img src="imgs/shooting-victims-api.png" class="img-fluid" width="500"></p>
<section id="the-anatomy-of-an-api-request" class="level4" data-number="1.2.1">
<h4 data-number="1.2.1" class="anchored" data-anchor-id="the-anatomy-of-an-api-request"><span class="header-section-number">1.2.1</span> The anatomy of an API request</h4>
<p><img src="imgs/carto-api.png" class="img-fluid" width="900"></p>
<ul>
<li><strong>Base URL</strong>: shown in blue</li>
<li><strong>?</strong>: shown in purple; it separates the base URL from the query parameters</li>
<li><strong>Query parameters</strong>: underlined in red; these parameters allow the user to customize the data response</li>
<li><strong>&amp;</strong>: underlined in green; the separator between the query parameters</li>
</ul>
<p>So, let’s break down the URL into its component parts:</p>
<div id="cell-27" class="cell" data-tags="[]" data-execution_count="41">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The API endpoint</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>carto_api_endpoint <span class="op">=</span> <span class="st">"https://phl.carto.com/api/v2/sql"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The query parameters</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"q"</span>: <span class="st">"SELECT * FROM shootings"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"format"</span>: <span class="st">"geojson"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"skipfields"</span>: <span class="st">"cartodb_id"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: we won't need the filename parameter, since we're not saving the data to a file</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "filename": "shootings"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note: SQL Queries
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>q</code> parameter is a <em>SQL query</em>. It allows you to select a specific subset of data from the larger database.</p>
<p>CARTO API documentation: <a href="https://carto.com/developers/sql-api/">https://carto.com/developers/sql-api/</a></p>
<p>SQL documentation: <a href="https://www.postgresql.org/docs/9.1/sql.html">https://www.postgresql.org/docs/9.1/sql.html</a></p>
<p><strong>General Query Syntax</strong></p>
<p><code>SELECT [field names] FROM [table name] WHERE [query]</code></p>
</div>
</div>
</section>
<section id="lets-try-it-out-in-python" class="level4" data-number="1.2.2">
<h4 data-number="1.2.2" class="anchored" data-anchor-id="lets-try-it-out-in-python"><span class="header-section-number">1.2.2</span> Let’s try it out in Python</h4>
<p>We’ll use Python’s <code>requests</code> library to use a “get” request to query the API endpoint with our desired query. Similar to our web scraping requests!</p>
<div id="cell-30" class="cell" data-tags="[]" data-execution_count="42">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s make the get request and pass the query parameters via the <code>params</code> keyword:</p>
<div id="cell-32" class="cell" data-tags="[]" data-execution_count="43">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(carto_api_endpoint, params<span class="op">=</span>params)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>&lt;Response [200]&gt;</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="44">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the returned data in JSON format</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a dictionary</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-34" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>dict</code></pre>
</div>
</div>
<div id="cell-35" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="47">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What are the keys?</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(features.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>['type', 'features']</code></pre>
</div>
</div>
<div id="cell-36" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="48">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>features[<span class="st">"type"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>'FeatureCollection'</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="49">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's look at the first feature</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>features[<span class="st">"features"</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>{'type': 'Feature',
 'geometry': {'type': 'Point', 'coordinates': [-75.232057, 39.932664]},
 'properties': {'objectid': 1,
  'year': 2015,
  'dc_key': '201512064080.00000000',
  'code': '400',
  'date_': '2015-08-12T00:00:00Z',
  'time': '10:00:00',
  'race': 'B',
  'sex': 'M',
  'age': '48',
  'wound': 'Multiple',
  'officer_involved': 'N',
  'offender_injured': 'N',
  'offender_deceased': 'N',
  'location': '6000 BLOCK Regent St',
  'latino': 0,
  'point_x': -75.23205744,
  'point_y': 39.93266438,
  'dist': '12',
  'inside': 0,
  'outside': 1,
  'fatal': 0}}</code></pre>
</div>
</div>
<p>Use the <code>GeoDataFrame.from_features()</code> function to create a GeoDataFrame.</p>
<div id="cell-39" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="50">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>shootings <span class="op">=</span> gpd.GeoDataFrame.from_features(features, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Don’t forget to specify the CRS of the input data when using <code>GeoDataFrame.from_features()</code>.</p>
</div>
</div>
<div id="cell-41" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="51">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>shootings.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dc_key</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">date_</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">wound</th>
<th data-quarto-table-cell-role="th">officer_involved</th>
<th data-quarto-table-cell-role="th">offender_injured</th>
<th data-quarto-table-cell-role="th">offender_deceased</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">latino</th>
<th data-quarto-table-cell-role="th">point_x</th>
<th data-quarto-table-cell-role="th">point_y</th>
<th data-quarto-table-cell-role="th">dist</th>
<th data-quarto-table-cell-role="th">inside</th>
<th data-quarto-table-cell-role="th">outside</th>
<th data-quarto-table-cell-role="th">fatal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POINT (-75.23206 39.93266)</td>
<td>1</td>
<td>2015</td>
<td>201512064080.00000000</td>
<td>400</td>
<td>2015-08-12T00:00:00Z</td>
<td>10:00:00</td>
<td>B</td>
<td>M</td>
<td>48</td>
<td>Multiple</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>6000 BLOCK Regent St</td>
<td>0.0</td>
<td>-75.232057</td>
<td>39.932664</td>
<td>12</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>POINT (-75.23004 39.93236)</td>
<td>2</td>
<td>2015</td>
<td>201512030511.00000000</td>
<td>400</td>
<td>2015-04-22T00:00:00Z</td>
<td>11:20:00</td>
<td>B</td>
<td>M</td>
<td>39</td>
<td>Multiple</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>2000 BLOCK S 60th St</td>
<td>0.0</td>
<td>-75.230036</td>
<td>39.932357</td>
<td>12</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>POINT (-75.22167 39.93636)</td>
<td>3</td>
<td>2015</td>
<td>201512012408.00000000</td>
<td>3400</td>
<td>2015-02-17T00:00:00Z</td>
<td>19:00:00</td>
<td>B</td>
<td>M</td>
<td>43</td>
<td>foot</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>5500 BLOCK Greenway Ave</td>
<td>0.0</td>
<td>-75.221674</td>
<td>39.936357</td>
<td>12</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>POINT (-75.22292 39.93538)</td>
<td>4</td>
<td>2015</td>
<td>201512002152.00000000</td>
<td>100</td>
<td>2015-01-10T00:00:00Z</td>
<td>00:34:00</td>
<td>B</td>
<td>M</td>
<td>24</td>
<td>Chest</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>1900 BLOCK S 56th St</td>
<td>0.0</td>
<td>-75.222921</td>
<td>39.935376</td>
<td>12</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>POINT (-75.22952 39.91840)</td>
<td>5</td>
<td>2015</td>
<td>201512000146.00000000</td>
<td>400</td>
<td>2015-01-01T00:00:00Z</td>
<td>13:41:00</td>
<td>B</td>
<td>M</td>
<td>24</td>
<td>Head</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>6600 BLOCK Dicks Ave</td>
<td>0.0</td>
<td>-75.229520</td>
<td>39.918396</td>
<td>12</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="at-home-exercise-visualizing-shootings-data" class="level4" data-number="1.2.3">
<h4 data-number="1.2.3" class="anchored" data-anchor-id="at-home-exercise-visualizing-shootings-data"><span class="header-section-number">1.2.3</span> At-Home Exercise: Visualizing shootings data</h4>
<p><strong>Step 1: Prep the data</strong></p>
<ul>
<li>Drop rows where the geometry is NaN</li>
<li>Convert to a better CRS (e.g., 3857)</li>
<li>Load city limits from Open Data Philly and trim to those only within city limits (some shootings have wrong coordinates, outside Philadelphia!)</li>
</ul>
<div id="cell-44" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure we remove missing geometries</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>shootings <span class="op">=</span> shootings.dropna(subset<span class="op">=</span>[<span class="st">"geometry"</span>])</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to a better CRS</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>shootings <span class="op">=</span> shootings.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-45" class="cell" data-tags="[]" data-execution_count="53">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>city_limits <span class="op">=</span> gpd.read_file(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://opendata.arcgis.com/datasets/405ec3da942d4e20869d4e1449a2be48_0.geojson"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-46" class="cell" data-tags="[]" data-execution_count="54">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove any shootings that are outside the city limits</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>shootings <span class="op">=</span> gpd.sjoin(shootings, city_limits, predicate<span class="op">=</span><span class="st">"within"</span>, how<span class="op">=</span><span class="st">"inner"</span>).drop(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">"index_right"</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Step 2: Plot the points</strong></p>
<p>A quick plot with geopandas to show the shootings as points, and overlay Philadelphia ZIP codes.</p>
<div id="cell-48" class="cell" data-tags="[]" data-execution_count="55">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From Open Data Philly</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>zip_codes <span class="op">=</span> gpd.read_file(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://opendata.arcgis.com/datasets/b54ec5210cee41c3a884c9086f7af1be_0.geojson"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>).to_crs(epsg<span class="op">=</span><span class="dv">3857</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-49" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ZIP Codes</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>zip_codes.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Shootings</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>shootings.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"crimson"</span>, markersize<span class="op">=</span><span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture-9A_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 3: Make a (more useful) hex bin map</strong></p>
<div id="cell-51" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the axes</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>), facecolor<span class="op">=</span>plt.get_cmap(<span class="st">"viridis"</span>)(<span class="dv">0</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Web Mercator and plot the hexbins</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> shootings.geometry.x</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> shootings.geometry.y</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>ax.hexbin(x, y, gridsize<span class="op">=</span><span class="dv">40</span>, mincnt<span class="op">=</span><span class="dv">1</span>, cmap<span class="op">=</span><span class="st">"viridis"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay the city limits</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>zip_codes.to_crs(epsg<span class="op">=</span><span class="dv">3857</span>).plot(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">"none"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, edgecolor<span class="op">=</span><span class="st">"white"</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture-9A_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-count-the-total-number-of-rows-in-a-table" class="level4" data-number="1.2.4">
<h4 data-number="1.2.4" class="anchored" data-anchor-id="example-count-the-total-number-of-rows-in-a-table"><span class="header-section-number">1.2.4</span> Example: Count the total number of rows in a table</h4>
<p>The SQL <code>COUNT</code> function can be applied to count all rows.</p>
<div id="cell-53" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="58">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    carto_api_endpoint, params<span class="op">=</span>{<span class="st">"q"</span>: <span class="st">"SELECT COUNT(*) FROM shootings"</span>}</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-54" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="59">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>{'rows': [{'count': 17110}],
 'time': 0.005,
 'fields': {'count': {'type': 'number', 'pgtype': 'int8'}},
 'total_rows': 1}</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s always a good idea to check how many rows you might be downloading before requesting all of the data from an API!</p>
</div>
</div>
</section>
<section id="example-select-all-columns-limiting-the-total-number-returned" class="level4" data-number="1.2.5">
<h4 data-number="1.2.5" class="anchored" data-anchor-id="example-select-all-columns-limiting-the-total-number-returned"><span class="header-section-number">1.2.5</span> Example: Select all columns, limiting the total number returned</h4>
<p>The <code>LIMIT</code> function limits the number of returned rows. It is very useful for taking a quick look at the format of a database.</p>
<div id="cell-57" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="60">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Limit the returned data to only 1 row</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT * FROM shootings LIMIT 1"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the request</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"q"</span>: query, <span class="st">"format"</span>: <span class="st">"geojson"</span>}</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(carto_api_endpoint, params<span class="op">=</span>params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Create the GeoDataFrame:</p>
<div id="cell-59" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="61">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> gpd.GeoDataFrame.from_features(response.json(), crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">cartodb_id</th>
<th data-quarto-table-cell-role="th">objectid</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">dc_key</th>
<th data-quarto-table-cell-role="th">code</th>
<th data-quarto-table-cell-role="th">date_</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">race</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">wound</th>
<th data-quarto-table-cell-role="th">officer_involved</th>
<th data-quarto-table-cell-role="th">offender_injured</th>
<th data-quarto-table-cell-role="th">offender_deceased</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">latino</th>
<th data-quarto-table-cell-role="th">point_x</th>
<th data-quarto-table-cell-role="th">point_y</th>
<th data-quarto-table-cell-role="th">dist</th>
<th data-quarto-table-cell-role="th">inside</th>
<th data-quarto-table-cell-role="th">outside</th>
<th data-quarto-table-cell-role="th">fatal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POINT (-75.23206 39.93266)</td>
<td>1</td>
<td>1</td>
<td>2015</td>
<td>201512064080.00000000</td>
<td>400</td>
<td>2015-08-12T00:00:00Z</td>
<td>10:00:00</td>
<td>B</td>
<td>M</td>
<td>48</td>
<td>Multiple</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>6000 BLOCK Regent St</td>
<td>0</td>
<td>-75.232057</td>
<td>39.932664</td>
<td>12</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="example-select-by-specific-column-values" class="level4" data-number="1.2.6">
<h4 data-number="1.2.6" class="anchored" data-anchor-id="example-select-by-specific-column-values"><span class="header-section-number">1.2.6</span> Example: Select by specific column values</h4>
<p>Use the <code>WHERE</code> function to select a subset where the logical condition is true.</p>
<p>Example #1: Select nonfatal shootings only</p>
<div id="cell-62" class="cell" data-tags="[]" data-execution_count="62">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select nonfatal shootings only</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT * FROM shootings WHERE fatal = 0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-63" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="63">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the request</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"q"</span>: query, <span class="st">"format"</span>: <span class="st">"geojson"</span>}</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(carto_api_endpoint, params<span class="op">=</span>params)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the GeoDataFrame</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>nonfatal <span class="op">=</span> gpd.GeoDataFrame.from_features(response.json(), crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of nonfatal shootings = "</span>, <span class="bu">len</span>(nonfatal))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of nonfatal shootings =  13416</code></pre>
</div>
</div>
<p>Example #2: Select shootings in 2023</p>
<div id="cell-65" class="cell" data-tags="[]" data-execution_count="64">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select based on "date_"</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT * FROM shootings WHERE date_ &gt;= '1/1/23'"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-66" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="65">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the request</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">"q"</span>: query, <span class="st">"format"</span>: <span class="st">"geojson"</span>}</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(carto_api_endpoint, params<span class="op">=</span>params)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the GeoDataFrame</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>shootings_2023 <span class="op">=</span> gpd.GeoDataFrame.from_features(response.json(), crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of shootings in 2023 = "</span>, <span class="bu">len</span>(shootings_2023))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>number of shootings in 2023 =  3419</code></pre>
</div>
</div>
</section>
<section id="at-home-exercise-explore-trends-by-month-and-day-of-week" class="level4" data-number="1.2.7">
<h4 data-number="1.2.7" class="anchored" data-anchor-id="at-home-exercise-explore-trends-by-month-and-day-of-week"><span class="header-section-number">1.2.7</span> At-Home Exercise: Explore trends by month and day of week</h4>
<section id="step-1-convert-the-date-column-to-datetime-objects" class="level5" data-number="1.2.7.1">
<h5 data-number="1.2.7.1" class="anchored" data-anchor-id="step-1-convert-the-date-column-to-datetime-objects"><span class="header-section-number">1.2.7.1</span> Step 1: Convert the date column to <code>DateTime</code> objects</h5>
<p>Add Month and Day of Week columns</p>
<div id="cell-69" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="66">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Condddvert the data column to a datetime object</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>shootings[<span class="st">"date"</span>] <span class="op">=</span> pd.to_datetime(shootings[<span class="st">"date_"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-70" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="67">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new columns: Month and Day of Week</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>shootings[<span class="st">"Month"</span>] <span class="op">=</span> shootings[<span class="st">"date"</span>].dt.month</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>shootings[<span class="st">"Day of Week"</span>] <span class="op">=</span> shootings[<span class="st">"date"</span>].dt.dayofweek  <span class="co"># Monday is 0, Sunday is 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-2-calculate-number-of-shootings-by-month-and-day-of-week" class="level5" data-number="1.2.7.2">
<h5 data-number="1.2.7.2" class="anchored" data-anchor-id="step-2-calculate-number-of-shootings-by-month-and-day-of-week"><span class="header-section-number">1.2.7.2</span> Step 2: Calculate number of shootings by month and day of week</h5>
<p>Use the familiar Groupby –&gt; size()</p>
<div id="cell-72" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="68">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> shootings.groupby([<span class="st">"Month"</span>, <span class="st">"Day of Week"</span>]).size()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>count <span class="op">=</span> count.reset_index(name<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>count.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">Day of Week</th>
<th data-quarto-table-cell-role="th">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0</td>
<td>198</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>1</td>
<td>169</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2</td>
<td>161</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>3</td>
<td>168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>4</td>
<td>164</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-3-make-a-heatmap-using-hvplot" class="level5" data-number="1.2.7.3">
<h5 data-number="1.2.7.3" class="anchored" data-anchor-id="step-3-make-a-heatmap-using-hvplot"><span class="header-section-number">1.2.7.3</span> Step 3: Make a heatmap using <code>hvplot</code></h5>
<div id="cell-74" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-tags="[]" data-execution_count="69">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember 0 is Monday and 6 is Sunday</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>count.hvplot.heatmap(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Day of Week"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Month"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    C<span class="op">=</span><span class="st">"Count"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"viridis"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    flip_yaxis<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div id="63a98937-31c5-46ad-aeed-9eed27a5bbb9">
  <div id="aa61121c-2e91-47aa-a3d2-90698dc7679f" data-root-id="63a98937-31c5-46ad-aeed-9eed27a5bbb9" style="display: contents;"></div>
</div>
<script type="application/javascript">(function(root) {
  var docs_json = {"3d6e11c9-c7f5-47ce-a213-294e1113f959":{"version":"3.7.3","title":"Bokeh Application","roots":[{"type":"object","name":"Row","id":"63a98937-31c5-46ad-aeed-9eed27a5bbb9","attributes":{"name":"Row00296","tags":["embedded"],"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"type":"object","name":"ImportedStyleSheet","id":"8ebeff98-8895-4eb6-8109-2b1fb37a4593","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.5/dist/css/loading.css"}},{"type":"object","name":"ImportedStyleSheet","id":"63ee5112-9f82-4c59-82e1-f56001d4b0d7","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.5/dist/css/listpanel.css"}},{"type":"object","name":"ImportedStyleSheet","id":"b926cd38-5431-49ed-b5fa-b90c3169e19d","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.5/dist/bundled/theme/default.css"}},{"type":"object","name":"ImportedStyleSheet","id":"95508580-12f6-4bdb-97fd-2ca6aaab1ada","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.5/dist/bundled/theme/native.css"}}],"min_width":400,"margin":0,"sizing_mode":"stretch_width","align":"start","children":[{"type":"object","name":"Spacer","id":"96512757-6937-481a-86c4-d65af18156bc","attributes":{"name":"HSpacer00300","stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"8ebeff98-8895-4eb6-8109-2b1fb37a4593"},{"id":"b926cd38-5431-49ed-b5fa-b90c3169e19d"},{"id":"95508580-12f6-4bdb-97fd-2ca6aaab1ada"}],"min_width":0,"margin":0,"sizing_mode":"stretch_width","align":"start"}},{"type":"object","name":"Figure","id":"117dd1df-8b40-4d3f-9909-c477a533131a","attributes":{"width":400,"height":500,"margin":[5,10],"sizing_mode":"fixed","align":"start","x_range":{"type":"object","name":"Range1d","id":"1c9cc291-69ba-4551-83b4-6b384f0a03fa","attributes":{"name":"Day of Week","tags":[[["Day of Week",null]],[]],"start":-0.5,"end":6.5,"reset_start":-0.5,"reset_end":6.5}},"y_range":{"type":"object","name":"Range1d","id":"07aeef05-4084-4063-952e-370eb5179c8e","attributes":{"name":"Month","tags":[[["Month",null]],{"type":"map","entries":[["invert_yaxis",true],["autorange",false]]}],"start":12.5,"end":0.5,"reset_start":12.5,"reset_end":0.5}},"x_scale":{"type":"object","name":"LinearScale","id":"e95b00e2-3c30-4e1c-960b-ce41a12dceb8"},"y_scale":{"type":"object","name":"LinearScale","id":"6c56f98d-5f14-42d3-858a-9c02099284e9"},"title":{"type":"object","name":"Title","id":"0b490692-3234-4bca-a7ca-4931b35566ae","attributes":{"text_color":"black","text_font_size":"12pt"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"b14f32fe-62e5-44f1-aa0c-f75c909356ff","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"66aa2e30-e072-405e-8f26-169121849400","attributes":{"selected":{"type":"object","name":"Selection","id":"eb852174-f410-41cd-b423-df964feaf7a0","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"b77c9b0b-e9b7-4a46-8d76-117a8e262a1d"},"data":{"type":"map","entries":[["Day_of_Week",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAgAAAAIAAAACAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAAAwAAAAMAAAADAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAABQAAAAUAAAAFAAAABQAAAAUAAAAFAAAABQAAAAUAAAAFAAAABQAAAAUAAAAFAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAABgAAAAYAAAAGAAAA"},"shape":[84],"dtype":"int32","order":"little"}],["Month",{"type":"ndarray","array":{"type":"bytes","data":"AQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAA"},"shape":[84],"dtype":"int32","order":"little"}],["zvalues",{"type":"ndarray","array":{"type":"bytes","data":"xgAAAKQAAAC2AAAAywAAAAIBAAD/AAAAIgEAAAIBAADfAAAA2AAAALIAAAC8AAAAqQAAAJkAAAC4AAAAnAAAAN8AAADoAAAA0QAAAN0AAADKAAAA2wAAALUAAACkAAAAoQAAAJoAAACyAAAAuAAAANwAAADEAAAA4QAAABABAAC1AAAAzwAAANEAAAC3AAAAqAAAAI8AAACWAAAAyAAAAMsAAADeAAAA/AAAAMMAAADGAAAAvgAAAJgAAAC6AAAApAAAAHsAAACuAAAAngAAALIAAADTAAAA+AAAANcAAADSAAAAoAAAALgAAACjAAAAugAAAJ0AAAC8AAAAyAAAAPYAAAAgAQAABgEAABABAADgAAAAAAEAALcAAACrAAAAzQAAAJYAAADKAAAA2gAAAAsBAAACAQAAJQEAAAUBAADeAAAA4AAAANYAAAC8AAAA"},"shape":[84],"dtype":"int32","order":"little"}],["width",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/"},"shape":[84],"dtype":"float64","order":"little"}],["height",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/AAAAAAAA8D8AAAAAAADwPwAAAAAAAPA/"},"shape":[84],"dtype":"float64","order":"little"}],["Count",["198","164","182","203","258","255","290","258","223","216","178","188","169","153","184","156","223","232","209","221","202","219","181","164","161","154","178","184","220","196","225","272","181","207","209","183","168","143","150","200","203","222","252","195","198","190","152","186","164","123","174","158","178","211","248","215","210","160","184","163","186","157","188","200","246","288","262","272","224","256","183","171","205","150","202","218","267","258","293","261","222","224","214","188"]]]}}},"view":{"type":"object","name":"CDSView","id":"a1bece17-b584-4fd7-93ff-404d520575ab","attributes":{"filter":{"type":"object","name":"AllIndices","id":"f1687c3e-f72f-48f3-9099-34e07713ad67"}}},"glyph":{"type":"object","name":"Rect","id":"54bddeb5-a098-4b9f-b958-b6c1555a93fd","attributes":{"tags":["apply_ranges"],"x":{"type":"field","field":"Day_of_Week"},"y":{"type":"field","field":"Month"},"width":{"type":"field","field":"width"},"height":{"type":"field","field":"height"},"line_color":{"type":"value","value":"#1f77b4"},"line_alpha":{"type":"value","value":0},"fill_color":{"type":"field","field":"zvalues","transform":{"type":"object","name":"LinearColorMapper","id":"e941019a-e4e9-4ccc-a350-6a9dce851f14","attributes":{"palette":["#440154","#440255","#440357","#450558","#45065a","#45085b","#46095c","#460b5e","#460c5f","#460e61","#470f62","#471163","#471265","#471466","#471567","#471669","#47186a","#48196b","#481a6c","#481c6e","#481d6f","#481e70","#482071","#482172","#482273","#482374","#472575","#472676","#472777","#472878","#472a79","#472b7a","#472c7b","#462d7c","#462f7c","#46307d","#46317e","#45327f","#45347f","#453580","#453681","#443781","#443982","#433a83","#433b83","#433c84","#423d84","#423e85","#424085","#414186","#414286","#404387","#404487","#3f4587","#3f4788","#3e4888","#3e4989","#3d4a89","#3d4b89","#3d4c89","#3c4d8a","#3c4e8a","#3b508a","#3b518a","#3a528b","#3a538b","#39548b","#39558b","#38568b","#38578c","#37588c","#37598c","#365a8c","#365b8c","#355c8c","#355d8c","#345e8d","#345f8d","#33608d","#33618d","#32628d","#32638d","#31648d","#31658d","#31668d","#30678d","#30688d","#2f698d","#2f6a8d","#2e6b8e","#2e6c8e","#2e6d8e","#2d6e8e","#2d6f8e","#2c708e","#2c718e","#2c728e","#2b738e","#2b748e","#2a758e","#2a768e","#2a778e","#29788e","#29798e","#287a8e","#287a8e","#287b8e","#277c8e","#277d8e","#277e8e","#267f8e","#26808e","#26818e","#25828e","#25838d","#24848d","#24858d","#24868d","#23878d","#23888d","#23898d","#22898d","#228a8d","#228b8d","#218c8d","#218d8c","#218e8c","#208f8c","#20908c","#20918c","#1f928c","#1f938b","#1f948b","#1f958b","#1f968b","#1e978a","#1e988a","#1e998a","#1e998a","#1e9a89","#1e9b89","#1e9c89","#1e9d88","#1e9e88","#1e9f88","#1ea087","#1fa187","#1fa286","#1fa386","#20a485","#20a585","#21a685","#21a784","#22a784","#23a883","#23a982","#24aa82","#25ab81","#26ac81","#27ad80","#28ae7f","#29af7f","#2ab07e","#2bb17d","#2cb17d","#2eb27c","#2fb37b","#30b47a","#32b57a","#33b679","#35b778","#36b877","#38b976","#39b976","#3bba75","#3dbb74","#3ebc73","#40bd72","#42be71","#44be70","#45bf6f","#47c06e","#49c16d","#4bc26c","#4dc26b","#4fc369","#51c468","#53c567","#55c666","#57c665","#59c764","#5bc862","#5ec961","#60c960","#62ca5f","#64cb5d","#67cc5c","#69cc5b","#6bcd59","#6dce58","#70ce56","#72cf55","#74d054","#77d052","#79d151","#7cd24f","#7ed24e","#81d34c","#83d34b","#86d449","#88d547","#8bd546","#8dd644","#90d643","#92d741","#95d73f","#97d83e","#9ad83c","#9dd93a","#9fd938","#a2da37","#a5da35","#a7db33","#aadb32","#addc30","#afdc2e","#b2dd2c","#b5dd2b","#b7dd29","#bade27","#bdde26","#bfdf24","#c2df22","#c5df21","#c7e01f","#cae01e","#cde01d","#cfe11c","#d2e11b","#d4e11a","#d7e219","#dae218","#dce218","#dfe318","#e1e318","#e4e318","#e7e419","#e9e419","#ece41a","#eee51b","#f1e51c","#f3e51e","#f6e61f","#f8e621","#fae622","#fde724"],"nan_color":"white","low":123,"high":293}}}}},"selection_glyph":{"type":"object","name":"Rect","id":"533dc747-cea7-41de-a0bd-08a3f0ae73bc","attributes":{"tags":["apply_ranges"],"x":{"type":"field","field":"Day_of_Week"},"y":{"type":"field","field":"Month"},"width":{"type":"field","field":"width"},"height":{"type":"field","field":"height"},"line_color":{"type":"value","value":"#1f77b4"},"line_alpha":{"type":"value","value":0},"fill_color":{"type":"field","field":"zvalues","transform":{"id":"e941019a-e4e9-4ccc-a350-6a9dce851f14"}}}},"nonselection_glyph":{"type":"object","name":"Rect","id":"8b7c6bd9-05bd-46c4-bd79-3ff834cdd113","attributes":{"tags":["apply_ranges"],"x":{"type":"field","field":"Day_of_Week"},"y":{"type":"field","field":"Month"},"width":{"type":"field","field":"width"},"height":{"type":"field","field":"height"},"line_color":{"type":"value","value":"#1f77b4"},"line_alpha":{"type":"value","value":0},"fill_color":{"type":"field","field":"zvalues","transform":{"id":"e941019a-e4e9-4ccc-a350-6a9dce851f14"}},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Rect","id":"d7be674b-da56-4234-bea1-65df85f0ca95","attributes":{"tags":["apply_ranges"],"x":{"type":"field","field":"Day_of_Week"},"y":{"type":"field","field":"Month"},"width":{"type":"field","field":"width"},"height":{"type":"field","field":"height"},"line_color":{"type":"value","value":"#1f77b4"},"line_alpha":{"type":"value","value":0},"fill_color":{"type":"field","field":"zvalues","transform":{"id":"e941019a-e4e9-4ccc-a350-6a9dce851f14"}},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"dadc219c-56ae-40a7-be28-65c2fb7b8660","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"58d9bd30-3ed1-47cc-82c7-aca7c7c724e6","attributes":{"tags":["hv_created"],"renderers":"auto","zoom_together":"none"}},{"type":"object","name":"HoverTool","id":"583e6283-58ca-43f7-a01d-8d5cac58a05d","attributes":{"tags":["hv_created"],"renderers":[{"id":"b14f32fe-62e5-44f1-aa0c-f75c909356ff"}],"tooltips":[["Day of Week","@{Day_of_Week}"],["Month","@{Month}"],["Count","@{Count}"]]}},{"type":"object","name":"SaveTool","id":"ba6869d2-e2f7-48a4-a4ef-dc6479bfd1e2"},{"type":"object","name":"PanTool","id":"bcd39dfd-b616-4a65-975d-b66c40017cf1"},{"type":"object","name":"BoxZoomTool","id":"d67f1074-b71e-408d-95ce-e5a54be8f0d6","attributes":{"dimensions":"both","overlay":{"type":"object","name":"BoxAnnotation","id":"a8bfb489-0e23-4232-8911-4d616d0f82e1","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"c22219ba-f2b2-4f03-b696-3cb4ec0a3262","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"7dbab721-2a5b-4726-9776-b6c584c16fa0","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"ResetTool","id":"2b4f19c9-2c60-4883-8cb8-ab68afcc8aae"}],"active_drag":{"id":"bcd39dfd-b616-4a65-975d-b66c40017cf1"},"active_scroll":{"id":"58d9bd30-3ed1-47cc-82c7-aca7c7c724e6"}}},"left":[{"type":"object","name":"LinearAxis","id":"723999ac-6488-465d-9d8f-e41af1832f19","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"ad132674-8a41-4a72-9e0c-2325e1d1dbb0","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"6d0389cb-a59f-4f44-bdea-880ee7cfb347"},"axis_label":"Month","major_label_policy":{"type":"object","name":"AllLabels","id":"6d290bdf-1059-424c-afd0-a3b52db7327c"}}}],"right":[{"type":"object","name":"ColorBar","id":"5e10b697-321d-469d-b60f-28cc155485d6","attributes":{"location":[0,0],"ticker":{"type":"object","name":"BasicTicker","id":"0f683bf8-3758-45e2-8e60-c7c32b4ccb3a","attributes":{"mantissas":[1,2,5]}},"major_label_policy":{"type":"object","name":"NoOverlap","id":"f0220bc7-0587-4e75-876c-6a4bf056cd22"},"label_standoff":8,"major_tick_line_color":"black","bar_line_color":"black","color_mapper":{"id":"e941019a-e4e9-4ccc-a350-6a9dce851f14"}}}],"below":[{"type":"object","name":"LinearAxis","id":"0eefc88b-b72d-403b-94cc-7b73453c18ab","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"a981d6ba-9e4b-4586-8ed6-1703b50d8450","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"9c510f6d-19c9-4436-8783-91139ce59710"},"axis_label":"Day of Week","major_label_policy":{"type":"object","name":"AllLabels","id":"bdc322d8-4453-4641-9652-7a2fd6dc0518"}}}],"center":[{"type":"object","name":"Grid","id":"a0f63d12-16a5-4bcf-b022-be6ab41f8e17","attributes":{"axis":{"id":"0eefc88b-b72d-403b-94cc-7b73453c18ab"},"grid_line_color":null}},{"type":"object","name":"Grid","id":"8cb0733e-57e7-4929-a060-c60fef63b58a","attributes":{"dimension":1,"axis":{"id":"723999ac-6488-465d-9d8f-e41af1832f19"},"grid_line_color":null}}],"min_border_top":10,"min_border_bottom":10,"min_border_left":10,"min_border_right":10,"output_backend":"webgl"}},{"type":"object","name":"Spacer","id":"059b724a-3e10-4f3c-bad2-e845e670338f","attributes":{"name":"HSpacer00301","stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"8ebeff98-8895-4eb6-8109-2b1fb37a4593"},{"id":"b926cd38-5431-49ed-b5fa-b90c3169e19d"},{"id":"95508580-12f6-4bdb-97fd-2ca6aaab1ada"}],"min_width":0,"margin":0,"sizing_mode":"stretch_width","align":"start"}}]}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"gap","kind":"Any","default":""},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"ReactiveESM1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"JSComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"ReactComponent1","properties":[{"name":"use_shadow_dom","kind":"Any","default":true},{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"AnyWidgetComponent1","properties":[{"name":"use_shadow_dom","kind":"Any","default":true},{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"max_notifications","kind":"Any","default":5},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_rendered","kind":"Any","default":false},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"TemplateEditor1","properties":[{"name":"layout","kind":"Any","default":[]}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"request_value1","properties":[{"name":"fill","kind":"Any","default":"none"},{"name":"_synced","kind":"Any","default":null},{"name":"_request_sync","kind":"Any","default":0}]},{"type":"model","name":"holoviews.plotting.bokeh.raster.HoverModel","properties":[{"name":"xy","kind":"Any","default":null},{"name":"data","kind":"Any","default":null}]}]}};
  var render_items = [{"docid":"3d6e11c9-c7f5-47ce-a213-294e1113f959","roots":{"63a98937-31c5-46ad-aeed-9eed27a5bbb9":"aa61121c-2e91-47aa-a3d2-90698dc7679f"},"root_ids":["63a98937-31c5-46ad-aeed-9eed27a5bbb9"]}];
  var docs = Object.values(docs_json)
  if (!docs) {
    return
  }
  const py_version = docs[0].version.replace('rc', '-rc.').replace('.dev', '-dev.')
  async function embed_document(root) {
    var Bokeh = get_bokeh(root)
    await Bokeh.embed.embed_items_notebook(docs_json, render_items);
    for (const render_item of render_items) {
      for (const root_id of render_item.root_ids) {
    const id_el = document.getElementById(root_id)
    if (id_el.children.length && id_el.children[0].hasAttribute('data-root-id')) {
      const root_el = id_el.children[0]
      root_el.id = root_el.id + '-rendered'
      for (const child of root_el.children) {
            // Ensure JupyterLab does not capture keyboard shortcuts
            // see: https://jupyterlab.readthedocs.io/en/4.1.x/extension/notebook.html#keyboard-interaction-model
        child.setAttribute('data-lm-suppress-shortcuts', 'true')
      }
    }
      }
    }
  }
  function get_bokeh(root) {
    if (root.Bokeh === undefined) {
      return null
    } else if (root.Bokeh.version !== py_version) {
      if (root.Bokeh.versions === undefined || !root.Bokeh.versions.has(py_version)) {
    return null
      }
      return root.Bokeh.versions.get(py_version);
    } else if (root.Bokeh.version === py_version) {
      return root.Bokeh
    }
    return null
  }
  function is_loaded(root) {
    var Bokeh = get_bokeh(root)
    return (Bokeh != null && Bokeh.Panel !== undefined)
  }
  if (is_loaded(root)) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (is_loaded(root)) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
      var Bokeh = get_bokeh(root)
      if (Bokeh == null || Bokeh.Panel == null) {
            console.warn("Panel: ERROR: Unable to run Panel code because Bokeh or Panel library is missing");
      } else {
        console.warn("Panel: WARNING: Attempting to render but not all required libraries could be resolved.")
        embed_document(root)
      }
        }
      }
    }, 25, root)
  }
})(window);</script>
</div>
</div>
<p><strong>Trends:</strong> more shootings on the weekends and in the summer months</p>
</section>
</section>
</section>
<section id="example-3-geoservices" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="example-3-geoservices"><span class="header-section-number">1.3</span> Example #3: GeoServices</h3>
<p>A GeoService is a standardized format for returning GeoJSON files over the web</p>
<p>Originally developed by Esri, in 2010 the specification was transferred to the Open Web Foundation.</p>
<p>Documentation: <a href="http://geoservices.github.io/">http://geoservices.github.io/</a></p>
<section id="example-philadelphia-neighborhoods" class="level4" data-number="1.3.1">
<h4 data-number="1.3.1" class="anchored" data-anchor-id="example-philadelphia-neighborhoods"><span class="header-section-number">1.3.1</span> Example: Philadelphia neighborhoods</h4>
<p>OpenDataPhilly provides GeoService API endpoints for the geometry hosted on its platform</p>
<p><a href="https://opendataphilly.org/datasets/philadelphia-neighborhoods/">https://opendataphilly.org/datasets/philadelphia-neighborhoods/</a></p>
<div id="cell-78" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="70">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The base URL for the neighborhoods layer</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>neighborhood_url <span class="op">=</span> <span class="st">"https://services1.arcgis.com/a6oRSxEw6eIY5Zfb/arcgis/rest/services/Philadelphia_Neighborhoods/FeatureServer/0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="imgs/geoservices-1.png" class="img-fluid" width="800"></p>
<p>Source: <a href="https://geoservices.github.io/resources.html">https://geoservices.github.io/resources.html</a></p>
</section>
<section id="the-query-endpoint" class="level4" data-number="1.3.2">
<h4 data-number="1.3.2" class="anchored" data-anchor-id="the-query-endpoint"><span class="header-section-number">1.3.2</span> The <code>query/</code> endpoint</h4>
<p>Layers have a single endpoint for requesting features: the <code>/query</code> endpoint.</p>
<div id="cell-81" class="cell" data-tags="[]" data-execution_count="71">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>neighborhood_query_endpoint <span class="op">=</span> neighborhood_url <span class="op">+</span> <span class="st">"/query"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-82" class="cell" data-tags="[]" data-execution_count="72">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>neighborhood_query_endpoint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>'https://services1.arcgis.com/a6oRSxEw6eIY5Zfb/arcgis/rest/services/Philadelphia_Neighborhoods/FeatureServer/0/query'</code></pre>
</div>
</div>
</section>
<section id="the-allowed-parameters" class="level4" data-number="1.3.3">
<h4 data-number="1.3.3" class="anchored" data-anchor-id="the-allowed-parameters"><span class="header-section-number">1.3.3</span> The allowed parameters</h4>
<p>The main request parameters are:</p>
<ul>
<li><code>where</code>: A SQL-like string to select a subset of features; to get all data, use <code>1=1</code> (always True)</li>
<li><code>outFields</code>: The list of columns to return; to get all, use <code>*</code></li>
<li><code>f</code>: The returned format; for GeoJSON, use “geojson”</li>
<li><code>outSR</code>: The desired output CRS</li>
</ul>
<div id="cell-84" class="cell" data-tags="[]" data-execution_count="73">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"where"</span>: <span class="st">"1=1"</span>,  <span class="co"># Give me all rows</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outFields"</span>: <span class="st">"*"</span>,  <span class="co"># All fields</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"f"</span>: <span class="st">"geojson"</span>,  <span class="co"># GeoJSON format</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outSR"</span>: <span class="st">"4326"</span>,  <span class="co"># The desired output CRS</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Make the request:</p>
<div id="cell-86" class="cell" data-tags="[]" data-execution_count="74">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(neighborhood_query_endpoint, params<span class="op">=</span>params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Get the features and create the GeoDataFrame:</p>
<div id="cell-88" class="cell" data-tags="[]" data-execution_count="75">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>json <span class="op">=</span> r.json()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> json[<span class="st">"features"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-89" class="cell" data-tags="[]" data-execution_count="76">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>hoods <span class="op">=</span> gpd.GeoDataFrame.from_features(features, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-90" class="cell" data-tags="[]" data-execution_count="77">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>hoods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">FID</th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">LISTNAME</th>
<th data-quarto-table-cell-role="th">MAPNAME</th>
<th data-quarto-table-cell-role="th">Shape_Leng</th>
<th data-quarto-table-cell-role="th">Shape__Area</th>
<th data-quarto-table-cell-role="th">Shape__Length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POLYGON ((-75.06773 40.00540, -75.06765 40.005...</td>
<td>1</td>
<td>BRIDESBURG</td>
<td>Bridesburg</td>
<td>Bridesburg</td>
<td>27814.546521</td>
<td>7.066581e+06</td>
<td>11074.587308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>POLYGON ((-75.01560 40.09487, -75.01768 40.092...</td>
<td>2</td>
<td>BUSTLETON</td>
<td>Bustleton</td>
<td>Bustleton</td>
<td>48868.458365</td>
<td>1.812721e+07</td>
<td>19485.686530</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>POLYGON ((-75.18848 40.07273, -75.18846 40.072...</td>
<td>3</td>
<td>CEDARBROOK</td>
<td>Cedarbrook</td>
<td>Cedarbrook</td>
<td>20021.415802</td>
<td>3.950980e+06</td>
<td>7980.051802</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>POLYGON ((-75.21221 40.08603, -75.21211 40.086...</td>
<td>4</td>
<td>CHESTNUT_HILL</td>
<td>Chestnut Hill</td>
<td>Chestnut Hill</td>
<td>56394.297195</td>
<td>1.265385e+07</td>
<td>22476.270236</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>POLYGON ((-75.18479 40.02837, -75.18426 40.027...</td>
<td>5</td>
<td>EAST_FALLS</td>
<td>East Falls</td>
<td>East Falls</td>
<td>27400.776417</td>
<td>6.434879e+06</td>
<td>10907.970158</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">153</td>
<td>POLYGON ((-75.18373 39.91351, -75.18194 39.913...</td>
<td>154</td>
<td>PACKER_PARK</td>
<td>Packer Park</td>
<td>Packer Park</td>
<td>21816.017948</td>
<td>4.584862e+06</td>
<td>8444.679631</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">154</td>
<td>POLYGON ((-75.14654 39.93005, -75.14804 39.921...</td>
<td>155</td>
<td>PENNSPORT</td>
<td>Pennsport</td>
<td>Pennsport</td>
<td>11823.233108</td>
<td>1.026917e+06</td>
<td>4706.597865</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">155</td>
<td>POLYGON ((-75.16986 39.92312, -75.17015 39.921...</td>
<td>156</td>
<td>NEWBOLD</td>
<td>Newbold</td>
<td>Newbold</td>
<td>10052.570885</td>
<td>9.281435e+05</td>
<td>3994.098029</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">156</td>
<td>POLYGON ((-75.17630 39.92425, -75.17798 39.923...</td>
<td>157</td>
<td>WEST_PASSYUNK</td>
<td>West Passyunk</td>
<td>West Passyunk</td>
<td>10499.291848</td>
<td>1.027608e+06</td>
<td>4173.301421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">157</td>
<td>POLYGON ((-75.15684 39.92897, -75.15712 39.927...</td>
<td>158</td>
<td>EAST_PASSYUNK</td>
<td>East Passyunk</td>
<td>East Passyunk</td>
<td>10987.761846</td>
<td>1.028395e+06</td>
<td>4368.384350</td>
</tr>
</tbody>
</table>

<p>158 rows × 8 columns</p>
</div>
</div>
</div>
<p>Now let’s select data just for East Falls and subset the returned columns:</p>
<div id="cell-92" class="cell" data-tags="[]" data-execution_count="78">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"where"</span>: <span class="st">"LISTNAME = 'East Falls'"</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outFields"</span>: [<span class="st">"LISTNAME"</span>],</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"f"</span>: <span class="st">"geojson"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"outSR"</span>: <span class="st">"4326"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(neighborhood_query_endpoint, params<span class="op">=</span>params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-93" class="cell" data-tags="[]" data-execution_count="79">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>east_falls <span class="op">=</span> gpd.GeoDataFrame.from_features(r.json()[<span class="st">"features"</span>], crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>east_falls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="79">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">LISTNAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>POLYGON ((-75.18479 40.02837, -75.18426 40.027...</td>
<td>East Falls</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="part-2-natural-language-processing-and-the-311-request-api" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="part-2-natural-language-processing-and-the-311-request-api"><span class="header-section-number">2</span> Part 2: Natural Language Processing and the 311 Request API</h2>
<p>In part two, we’ll pull data using the API for the Philly 311 system, available at: <a href="https://iframe.publicstuff.com/#?client_id=242">https://iframe.publicstuff.com/#?client_id=242</a></p>
<p>We saw this site previously when we talked about web scraping last week:</p>
<p><img src="imgs/philly-311.png" class="img-fluid"></p>
<p>Let’s take another look at the address where the site is pulling its data from:</p>
<p><code>https://vc0.publicstuff.com/api/2.0/requests_list?client_id=242&amp;device=iframe&amp;limit=35&amp;page=1</code></p>
<p>This is just an <strong>API request!</strong> It’s an example of a <em>non-public, internal</em> API, but we can reverse-engineer it to extract the data we want!</p>
<p>Break it down into it’s component parts:</p>
<ul>
<li><strong>Base URL:</strong> <a href="https://vc0.publicstuff.com/api/2.0/requests_list">https://vc0.publicstuff.com/api/2.0/requests_list</a></li>
<li><strong>Query parameters:</strong> client_id, device, limit, page</li>
</ul>
<p>It looks likes “client_id” identifies data for the City of Philadelphia, which is definitely a required parameter. Otherwise, the other parameters seem optional, returning the requests on a certain device and viewing page.</p>
<p>Let’s test it out. We’ll grab 2 requests from the first page:</p>
<div id="cell-98" class="cell" data-tags="[]" data-execution_count="80">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://vc0.publicstuff.com/api/2.0/requests_list"</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    params<span class="op">=</span>{<span class="st">"client_id"</span>: <span class="dv">242</span>, <span class="st">"page"</span>: <span class="dv">1</span>, <span class="st">"limit"</span>: <span class="dv">2</span>},</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>json <span class="op">=</span> r.json()</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>{'response': {'requests': [{'request': {'id': 17210010,
     'image_thumbnail': '',
     'title': 'Vacant Lot Clean Up',
     'description': 'Please for the love of God clean this bs up. My house has do many mice and flies because of this nonsense.',
     'status': 'submitted',
     'address': '615 Winton St, Philadelphia, PA 19148, USA',
     'location': '',
     'zipcode': None,
     'foreign_id': '17974428',
     'date_created': 1754538539,
     'count_comments': 0,
     'count_followers': 0,
     'count_supporters': 0,
     'lat': 39.9220356,
     'lon': -75.1574552,
     'user_follows': 0,
     'user_comments': 0,
     'user_request': 0,
     'rank': '1',
     'user': 'Gilmoregirl117'}},
   {'request': {'id': 17210006,
     'image_thumbnail': '',
     'title': 'Maintenance Complaint',
     'description': 'Front I and grass never  cut very tall',
     'status': 'submitted',
     'address': '1544 Stoney Ln, Philadelphia, PA 19115, USA',
     'location': '',
     'zipcode': None,
     'foreign_id': '17974427',
     'date_created': 1754537919,
     'count_comments': 0,
     'count_followers': 0,
     'count_supporters': 0,
     'lat': 40.0837405,
     'lon': -75.0443821,
     'user_follows': 0,
     'user_comments': 0,
     'user_request': 0,
     'rank': '1',
     'user': 'KOZA'}}],
  'count': '2',
  'benchmark': 9.287112951278687,
  'status': {'type': 'success',
   'message': 'Success',
   'code': 200,
   'code_message': 'Ok'}}}</code></pre>
</div>
</div>
<p>Now we need to understand the structure of the response. First, access the list of requests:</p>
<div id="cell-100" class="cell" data-tags="[]" data-execution_count="81">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>request_list <span class="op">=</span> json[<span class="st">"response"</span>][<span class="st">"requests"</span>]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>request_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>[{'request': {'id': 17210010,
   'image_thumbnail': '',
   'title': 'Vacant Lot Clean Up',
   'description': 'Please for the love of God clean this bs up. My house has do many mice and flies because of this nonsense.',
   'status': 'submitted',
   'address': '615 Winton St, Philadelphia, PA 19148, USA',
   'location': '',
   'zipcode': None,
   'foreign_id': '17974428',
   'date_created': 1754538539,
   'count_comments': 0,
   'count_followers': 0,
   'count_supporters': 0,
   'lat': 39.9220356,
   'lon': -75.1574552,
   'user_follows': 0,
   'user_comments': 0,
   'user_request': 0,
   'rank': '1',
   'user': 'Gilmoregirl117'}},
 {'request': {'id': 17210006,
   'image_thumbnail': '',
   'title': 'Maintenance Complaint',
   'description': 'Front I and grass never  cut very tall',
   'status': 'submitted',
   'address': '1544 Stoney Ln, Philadelphia, PA 19115, USA',
   'location': '',
   'zipcode': None,
   'foreign_id': '17974427',
   'date_created': 1754537919,
   'count_comments': 0,
   'count_followers': 0,
   'count_supporters': 0,
   'lat': 40.0837405,
   'lon': -75.0443821,
   'user_follows': 0,
   'user_comments': 0,
   'user_request': 0,
   'rank': '1',
   'user': 'KOZA'}}]</code></pre>
</div>
</div>
<p>We need to extract out the “request” key of each list entry. Let’s do that and create a DataFrame:</p>
<div id="cell-102" class="cell" data-tags="[]" data-execution_count="82">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame([r[<span class="st">"request"</span>] <span class="cf">for</span> r <span class="kw">in</span> request_list])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-103" class="cell" data-tags="[]" data-execution_count="83">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">image_thumbnail</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">foreign_id</th>
<th data-quarto-table-cell-role="th">date_created</th>
<th data-quarto-table-cell-role="th">count_comments</th>
<th data-quarto-table-cell-role="th">count_followers</th>
<th data-quarto-table-cell-role="th">count_supporters</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">user_follows</th>
<th data-quarto-table-cell-role="th">user_comments</th>
<th data-quarto-table-cell-role="th">user_request</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">user</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17210010</td>
<td></td>
<td>Vacant Lot Clean Up</td>
<td>Please for the love of God clean this bs up. M...</td>
<td>submitted</td>
<td>615 Winton St, Philadelphia, PA 19148, USA</td>
<td></td>
<td>None</td>
<td>17974428</td>
<td>1754538539</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39.922036</td>
<td>-75.157455</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>Gilmoregirl117</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>17210006</td>
<td></td>
<td>Maintenance Complaint</td>
<td>Front I and grass never cut very tall</td>
<td>submitted</td>
<td>1544 Stoney Ln, Philadelphia, PA 19115, USA</td>
<td></td>
<td>None</td>
<td>17974427</td>
<td>1754537919</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>40.083740</td>
<td>-75.044382</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>KOZA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Success! But we want to build up a larger dataset…let’s pull data for the first 3 pages of data. This will take a minute or two…</p>
<div id="cell-105" class="cell" data-tags="[]" data-execution_count="84">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store the data we request</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> []</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of pages</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>total_pages <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each page</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> page_num <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, total_pages <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print out the page number</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Getting data for page #</span><span class="sc">{</span>page_num<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make the request</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> requests.get(</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://vc0.publicstuff.com/api/2.0/requests_list"</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        params<span class="op">=</span>{</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"client_id"</span>: <span class="dv">242</span>,  <span class="co"># Unique identifier for Philadelphia</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"page"</span>: page_num,  <span class="co"># What page of data to pull</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"limit"</span>: <span class="dv">200</span>,  <span class="co"># How many rows per page</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the json</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> r.json()</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the new data to our list and save</span></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data <span class="op">+</span> [r[<span class="st">"request"</span>] <span class="cf">for</span> r <span class="kw">in</span> d[<span class="st">"response"</span>][<span class="st">"requests"</span>]]</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe</span></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Getting data for page #1...
Getting data for page #2...
Getting data for page #3...</code></pre>
</div>
</div>
<div id="cell-106" class="cell" data-tags="[]" data-execution_count="85">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="85">
<pre><code>600</code></pre>
</div>
</div>
<div id="cell-107" class="cell" data-tags="[]" data-execution_count="86">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">image_thumbnail</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">status</th>
<th data-quarto-table-cell-role="th">address</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">zipcode</th>
<th data-quarto-table-cell-role="th">foreign_id</th>
<th data-quarto-table-cell-role="th">date_created</th>
<th data-quarto-table-cell-role="th">count_comments</th>
<th data-quarto-table-cell-role="th">count_followers</th>
<th data-quarto-table-cell-role="th">count_supporters</th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
<th data-quarto-table-cell-role="th">user_follows</th>
<th data-quarto-table-cell-role="th">user_comments</th>
<th data-quarto-table-cell-role="th">user_request</th>
<th data-quarto-table-cell-role="th">rank</th>
<th data-quarto-table-cell-role="th">user</th>
<th data-quarto-table-cell-role="th">primary_attachment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17210222</td>
<td></td>
<td>Vacant Lot Clean Up</td>
<td>overgrown</td>
<td>submitted</td>
<td>2222 Moore St, Philadelphia, PA 19145, USA</td>
<td></td>
<td>None</td>
<td>17974478</td>
<td>1754566097</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39.929688</td>
<td>-75.182719</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td></td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>17210217</td>
<td></td>
<td>Other</td>
<td></td>
<td>submitted</td>
<td>10943 Waldemire Dr, Philadelphia, PA 19154, USA</td>
<td></td>
<td>None</td>
<td>17974475</td>
<td>1754565873</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>40.076298</td>
<td>-74.982679</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td></td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>17210209</td>
<td>https://d17aqltn7cihbm.cloudfront.net/uploads/...</td>
<td>Pothole Repair</td>
<td>Whole in street</td>
<td>submitted</td>
<td>1223 Morris St,Philadelphia, PA 19148</td>
<td>Philadelphia, Pennsylvania</td>
<td>19148</td>
<td>17974474</td>
<td>1754565680</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39.928913</td>
<td>-75.165887</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>spfdeutch</td>
<td>{'id': 5609758, 'extension': 'jpg', 'content_t...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>17210205</td>
<td>https://d17aqltn7cihbm.cloudfront.net/uploads/...</td>
<td>Illegal Dumping</td>
<td>undefined</td>
<td>submitted</td>
<td>761 Sloan St, Philadelphia, PA 19104, USA</td>
<td></td>
<td>None</td>
<td>17974473</td>
<td>1754565543</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>39.966908</td>
<td>-75.202294</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>unionhill</td>
<td>{'id': 5609756, 'extension': 'jpg', 'content_t...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>17210194</td>
<td>https://d17aqltn7cihbm.cloudfront.net/uploads/...</td>
<td>Maintenance Complaint</td>
<td>Property is overgrown with grass and weeds</td>
<td>submitted</td>
<td>7534 Tabor Ave, Philadelphia, PA 19111, USA</td>
<td></td>
<td>None</td>
<td>17974470</td>
<td>1754564609</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>40.063343</td>
<td>-75.077113</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>mpa1213</td>
<td>{'id': 5609750, 'extension': 'jpeg', 'content_...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s focus on the “description” column. This is the narrative text that the user inputs when entering a 311 request, and it is an example of <em>semi-structured</em> data. For the rest of today, we’ll focus on how to extract information from semi-structured data.</p>
<section id="semi-structured-data" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="semi-structured-data"><span class="header-section-number">2.1</span> Semi-structured data</h3>
<p>Data that contains some elements that cannot be easily consumed by computers</p>
<p><strong>Examples:</strong> human-readable text, audio, images, etc</p>
</section>
<section id="key-challenges" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="key-challenges"><span class="header-section-number">2.2</span> Key challenges</h3>
<ul>
<li><strong>Text mining</strong>: analyzing blocks of text to extract the relevant pieces of information</li>
<li><strong>Natural language processing (NLP)</strong>: programming computers to process and analyze human languages</li>
<li><strong>Sentiment analysis</strong>: analyzing blocks of text to derive the attitude or emotional state of the person</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Twitter is one of the main API examples of semi-structured data, but since Elon Musk overhauled the API access, it’s become prohibitively expensive to access (RIP 💀)</p>
</div>
</div>
<p>To get started, let’s remove any requests where the description is missing:</p>
<div id="cell-113" class="cell" data-tags="[]" data-execution_count="87">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.dropna(subset<span class="op">=</span>[<span class="st">"description"</span>])</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>data_final <span class="op">=</span> data.loc[data[<span class="st">"description"</span>] <span class="op">!=</span> <span class="st">""</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-114" class="cell" data-tags="[]" data-execution_count="88">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Strip out spaces and convert to a list</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>descriptions <span class="op">=</span> data_final[<span class="st">"description"</span>].<span class="bu">str</span>.strip().tolist()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>descriptions[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="88">
<pre><code>['overgrown',
 'Whole in street',
 'undefined',
 'Property is overgrown with grass and weeds',
 'Has been parked here for months, obviously living in it. Starting to see garbage on the street and sidewalk outside of it',
 'Blighted property. Vagrants are now back in the property after the city boarded it up with wood. The building is in disrepair. It is a quality of life concern because there are home owners and renters that live on the block. Please come out and boarder with a more permanent solution like cinderblocks and cement. Because these vandalizing vagrants who also need homelessness and drug abuse help have caused  major damage to the eye care business next door.',
 "They've been starting at 6:30am for months, the law is 7. It's incredibly frustrating",
 'Bailey 894 PSEO',
 'periodically both refuse and recycling has missed the pick up. the items are stored on the side of the building. they pull up the driveway and back out the same way and miss the items. if they go all they way through the driveway they would see the items',
 'Overgrown Weeds Is Blocking The Driveway Preventing Access To Rear Of Property']</code></pre>
</div>
</div>
</section>
<section id="use-case-1-calculating-word-frequencies" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="use-case-1-calculating-word-frequencies"><span class="header-section-number">2.3</span> Use case #1: calculating word frequencies</h3>
<p>An example of <strong>text mining</strong></p>
<section id="text-mining-and-dealing-with-messy-data" class="level4" data-number="2.3.1">
<h4 data-number="2.3.1" class="anchored" data-anchor-id="text-mining-and-dealing-with-messy-data"><span class="header-section-number">2.3.1</span> Text mining and dealing with messy data</h4>
<p>Some steps to clean up our text data:</p>
<ol type="1">
<li>Break strings into words</li>
<li>Remove capitalization</li>
<li>Remove stop words</li>
<li>Remove punctuation</li>
</ol>
<p><strong>1. Break strings into words</strong></p>
<p>Use the <code>.split()</code> command to break a string into words by splitting on spaces.</p>
<div id="cell-118" class="cell" data-tags="[]" data-execution_count="89">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>example_string <span class="op">=</span> <span class="st">"This is an Example"</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>example_string.split()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>['This', 'is', 'an', 'Example']</code></pre>
</div>
</div>
<div id="cell-119" class="cell" data-tags="[]" data-execution_count="90">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>descriptions_words <span class="op">=</span> [desc.split() <span class="cf">for</span> desc <span class="kw">in</span> descriptions]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-120" class="cell" data-tags="[]" data-execution_count="91">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>descriptions_words[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="91">
<pre><code>['overgrown']</code></pre>
</div>
</div>
<p>This is a list of lists, e.g., the first element is a list of words. Let’s <em>flatten</em> this into a list of just words:</p>
<div id="cell-122" class="cell" data-tags="[]" data-execution_count="92">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>descriptions_words_flat <span class="op">=</span> []</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> list_of_words <span class="kw">in</span> descriptions_words:</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> list_of_words:</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>        descriptions_words_flat.append(word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-123" class="cell" data-tags="[]" data-execution_count="93">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>descriptions_words_flat[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="93">
<pre><code>'overgrown'</code></pre>
</div>
</div>
<div id="cell-124" class="cell" data-tags="[]" data-execution_count="94">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(descriptions_words_flat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>21921</code></pre>
</div>
</div>
<p><strong>2. Convert all words to lower case</strong></p>
<p>Use <code>.lower()</code> makes all words lower cased</p>
<div id="cell-126" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="95">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>descriptions_words_lower <span class="op">=</span> [word.lower() <span class="cf">for</span> word <span class="kw">in</span> descriptions_words_flat]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-127" class="cell" data-tags="[]" data-execution_count="96">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>descriptions_words_lower[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="96">
<pre><code>['overgrown',
 'whole',
 'in',
 'street',
 'undefined',
 'property',
 'is',
 'overgrown',
 'with',
 'grass']</code></pre>
</div>
</div>
<div id="cell-128" class="cell" data-tags="[]" data-execution_count="97">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(descriptions_words_lower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>21921</code></pre>
</div>
</div>
<p><strong>3. Remove stop words</strong></p>
<p>Common words that do not carry much significance and are often ignored in text analysis.</p>
<p>We can use the <code>nltk</code> package.</p>
<p>The “Natural Language Toolkit” https://www.nltk.org/</p>
<p>Import and download the stop words:</p>
<div id="cell-132" class="cell" data-execution_count="100">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install nltk</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-133" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="101">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">"stopwords"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[nltk_data] Downloading package stopwords to
[nltk_data]     /Users/jianglix/nltk_data...
[nltk_data]   Unzipping corpora/stopwords.zip.</code></pre>
</div>
</div>
<p>Get the list of common stop words:</p>
<div id="cell-135" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="102">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(nltk.corpus.stopwords.words(<span class="st">"english"</span>)))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>stop_words[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>['those',
 "we'd",
 'under',
 'further',
 "he'll",
 'with',
 "we'll",
 'why',
 "i'll",
 'at']</code></pre>
</div>
</div>
<div id="cell-136" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="103">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>198</code></pre>
</div>
</div>
<div id="cell-137" class="cell" data-tags="[]" data-execution_count="104">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>descriptions_no_stop <span class="op">=</span> []</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word <span class="kw">in</span> descriptions_words_lower:</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stop_words:</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>        descriptions_no_stop.append(word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-138" class="cell" data-tags="[]" data-execution_count="105">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>descriptions_no_stop <span class="op">=</span> [</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    word <span class="cf">for</span> word <span class="kw">in</span> descriptions_words_lower <span class="cf">if</span> word <span class="kw">not</span> <span class="kw">in</span> stop_words</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-139" class="cell" data-tags="[]" data-execution_count="106">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(descriptions_no_stop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>14301</code></pre>
</div>
</div>
<p><strong>4. Remove punctuation</strong></p>
<p>Get the list of common punctuation:</p>
<div id="cell-142" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;subslide&quot;}" data-execution_count="107">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-143" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="108">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>punctuation <span class="op">=</span> <span class="bu">list</span>(string.punctuation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-144" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;fragment&quot;}" data-execution_count="109">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>punctuation[:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>['!', '"', '#', '$', '%']</code></pre>
</div>
</div>
<p>Remove punctuation from words:</p>
<div id="cell-146" class="cell" data-tags="[]" data-execution_count="110">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>descriptions_final <span class="op">=</span> []</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all words</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word <span class="kw">in</span> descriptions_no_stop:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove any punctuation from the words</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> punctuation:</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        word <span class="op">=</span> word.replace(p, <span class="st">""</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save it if the string is not empty</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> word <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>        descriptions_final.append(word)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Convert to a Dataframe with one column:</p>
<div id="cell-148" class="cell" data-tags="[]" data-execution_count="111">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> pd.DataFrame({<span class="st">"words"</span>: descriptions_final})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-149" class="cell" data-tags="[]" data-execution_count="112">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>words.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="112">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">words</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>overgrown</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>whole</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>street</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>undefined</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>property</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Calculate the word frequencies</strong></p>
<p>Use a pandas groupby and sort to put in descending order:</p>
<div id="cell-151" class="cell" data-tags="[]" data-execution_count="113">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> (</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    words.groupby(<span class="st">"words"</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">"size"</span>, ascending<span class="op">=</span><span class="va">False</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The top 15 words by frequency:</p>
<div id="cell-153" class="cell" data-tags="[]" data-execution_count="114">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>top15 <span class="op">=</span> N.head(<span class="dv">15</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>top15</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">words</th>
<th data-quarto-table-cell-role="th">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>street</td>
<td>234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>trash</td>
<td>220</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>please</td>
<td>215</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>people</td>
<td>190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>especially</td>
<td>175</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>philadelphia</td>
<td>174</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>police</td>
<td>140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>17th</td>
<td>140</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>3815</td>
<td>140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>eagles</td>
<td>121</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>north</td>
<td>109</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>arrest</td>
<td>105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>gay</td>
<td>104</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>contact</td>
<td>104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>address</td>
<td>97</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Plot the frequencies</strong></p>
<p>Use <code>seaborn</code> to plot our DataFrame of word counts…</p>
<div id="cell-155" class="cell" data-slideshow="{&quot;slide_type&quot;:&quot;slide&quot;}" data-execution_count="115">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot horizontal bar graph</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"words"</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"size"</span>,</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>top15,</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"#cc3000"</span>,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    saturation<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Most Common Words Found in 311 Requests"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lecture-9A_files/figure-html/cell-81-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Takeaway:</strong> Philly cares about trash! They don’t call it Filthadelphia for nothing…</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>